//# -*- indent-tabs-mode: nil  c-basic-offset: 2 -*-
//###########################################################################
//# PROJECT: Waters
//# PACKAGE: net.sourceforge.waters.model.module
//# CLASS:   ModuleProxyCloner
//###########################################################################
//# $Id: ModuleProxyCloner.java,v 1.3 2007-07-21 08:46:39 robi Exp $
//###########################################################################
//# THIS FILE HAS BEEN AUTOMATICALLY GENERATED BY A SCRIPT.
//# DO NOT EDIT.
//###########################################################################

package net.sourceforge.waters.model.module;

import java.awt.Color;
import java.awt.geom.Point2D;
import java.awt.geom.Rectangle2D;
import java.util.Collection;
import java.util.HashMap;
import java.util.LinkedList;
import java.util.Map;

import net.sourceforge.waters.model.base.Proxy;
import net.sourceforge.waters.model.base.VisitorException;
import net.sourceforge.waters.model.base.WatersRuntimeException;
import net.sourceforge.waters.model.expr.BinaryOperator;
import net.sourceforge.waters.model.expr.UnaryOperator;
import net.sourceforge.waters.model.unchecked.Casting;

import net.sourceforge.waters.xsd.base.ComponentKind;
import net.sourceforge.waters.xsd.base.EventKind;
import net.sourceforge.waters.xsd.module.AnchorPosition;
import net.sourceforge.waters.xsd.module.ScopeKind;
import net.sourceforge.waters.xsd.module.SplineKind;


/**
 * A tool to create deep copies of Module objects.
 * Parameterised by a factory, this visitor can accept objects from
 * one {@link Proxy} implementation and translate them to another.
 *
 * @author Robi Malik
 */

public class ModuleProxyCloner
  extends AbstractModuleProxyVisitor
{

  //#########################################################################
  //# Constructor
  public ModuleProxyCloner(final ModuleProxyFactory factory)
  {
    mFactory = factory;
    mNodeMap = new HashMap<String,NodeProxy>();
  }


  //#########################################################################
  //# Invocation
  public Proxy getClone(final Proxy proxy)
  {
    try {
      return (Proxy) proxy.acceptVisitor(this);
    } catch (final VisitorException exception) {
      throw new WatersRuntimeException(exception);
    } finally {
      mNodeMap.clear();
    }
  }


  //#########################################################################
  //# Interface net.sourceforge.waters.model.module.ModuleProxyVisitor
  public AliasProxy visitAliasProxy
    (final AliasProxy proxy)
    throws VisitorException
  {
    return (AliasProxy) proxy.acceptVisitor(this);
  }

  public BinaryExpressionProxy visitBinaryExpressionProxy
    (final BinaryExpressionProxy proxy)
    throws VisitorException
  {
    final String plainText = proxy.getPlainText();
    final BinaryOperator operator = proxy.getOperator();
    final SimpleExpressionProxy left0 = proxy.getLeft();
    final SimpleExpressionProxy left = visitSimpleExpressionProxy(left0);
    final SimpleExpressionProxy right0 = proxy.getRight();
    final SimpleExpressionProxy right = visitSimpleExpressionProxy(right0);
    return mFactory.createBinaryExpressionProxy(plainText,
                                                operator,
                                                left,
                                                right);
  }

  public BooleanConstantProxy visitBooleanConstantProxy
    (final BooleanConstantProxy proxy)
    throws VisitorException
  {
    final String plainText = proxy.getPlainText();
    final boolean value = proxy.isValue();
    return mFactory.createBooleanConstantProxy(plainText,
                                               value);
  }

  public BoxGeometryProxy visitBoxGeometryProxy
    (final BoxGeometryProxy proxy)
    throws VisitorException
  {
    final Rectangle2D rectangle = proxy.getRectangle();
    return mFactory.createBoxGeometryProxy(rectangle);
  }

  public ColorGeometryProxy visitColorGeometryProxy
    (final ColorGeometryProxy proxy)
    throws VisitorException
  {
    final Collection<Color> colorSet = proxy.getColorSet();
    return mFactory.createColorGeometryProxy(colorSet);
  }

  public ComponentProxy visitComponentProxy
    (final ComponentProxy proxy)
    throws VisitorException
  {
    return (ComponentProxy) proxy.acceptVisitor(this);
  }

  public ConstantAliasProxy visitConstantAliasProxy
    (final ConstantAliasProxy proxy)
    throws VisitorException
  {
    final IdentifierProxy identifier0 = proxy.getIdentifier();
    final IdentifierProxy identifier = visitIdentifierProxy(identifier0);
    final ExpressionProxy expression0 = proxy.getExpression();
    final ExpressionProxy expression = visitExpressionProxy(expression0);
    final ScopeKind scope = proxy.getScope();
    return mFactory.createConstantAliasProxy(identifier,
                                             expression,
                                             scope);
  }

  public EdgeProxy visitEdgeProxy
    (final EdgeProxy proxy)
    throws VisitorException
  {
    final NodeProxy source0 = proxy.getSource();
    final NodeProxy source =
      source0 == null ? null : lookupNodeProxy(source0);
    final NodeProxy target0 = proxy.getTarget();
    final NodeProxy target =
      target0 == null ? null : lookupNodeProxy(target0);
    final LabelBlockProxy labelBlock0 = proxy.getLabelBlock();
    final LabelBlockProxy labelBlock = visitLabelBlockProxy(labelBlock0);
    final GuardActionBlockProxy guardActionBlock0 =
      proxy.getGuardActionBlock();
    final GuardActionBlockProxy guardActionBlock =
      guardActionBlock0 == null ? null : visitGuardActionBlockProxy(guardActionBlock0);
    final SplineGeometryProxy geometry0 = proxy.getGeometry();
    final SplineGeometryProxy geometry =
      geometry0 == null ? null : visitSplineGeometryProxy(geometry0);
    final PointGeometryProxy startPoint0 = proxy.getStartPoint();
    final PointGeometryProxy startPoint =
      startPoint0 == null ? null : visitPointGeometryProxy(startPoint0);
    final PointGeometryProxy endPoint0 = proxy.getEndPoint();
    final PointGeometryProxy endPoint =
      endPoint0 == null ? null : visitPointGeometryProxy(endPoint0);
    return mFactory.createEdgeProxy(source,
                                    target,
                                    labelBlock,
                                    guardActionBlock,
                                    geometry,
                                    startPoint,
                                    endPoint);
  }

  public EnumSetExpressionProxy visitEnumSetExpressionProxy
    (final EnumSetExpressionProxy proxy)
    throws VisitorException
  {
    final String plainText = proxy.getPlainText();
    final Collection<SimpleIdentifierProxy> items0 = proxy.getItems();
    final Collection<SimpleIdentifierProxy> items =
      cloneProxyCollection(items0);
    return mFactory.createEnumSetExpressionProxy(plainText,
                                                 items);
  }

  public EventAliasProxy visitEventAliasProxy
    (final EventAliasProxy proxy)
    throws VisitorException
  {
    final IdentifierProxy identifier0 = proxy.getIdentifier();
    final IdentifierProxy identifier = visitIdentifierProxy(identifier0);
    final ExpressionProxy expression0 = proxy.getExpression();
    final ExpressionProxy expression = visitExpressionProxy(expression0);
    return mFactory.createEventAliasProxy(identifier,
                                          expression);
  }

  public EventDeclProxy visitEventDeclProxy
    (final EventDeclProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final EventKind kind = proxy.getKind();
    final boolean observable = proxy.isObservable();
    final ScopeKind scope = proxy.getScope();
    final Collection<SimpleExpressionProxy> ranges0 = proxy.getRanges();
    final Collection<SimpleExpressionProxy> ranges =
      cloneProxyCollection(ranges0);
    final ColorGeometryProxy colorGeometry0 = proxy.getColorGeometry();
    final ColorGeometryProxy colorGeometry =
      colorGeometry0 == null ? null : visitColorGeometryProxy(colorGeometry0);
    return mFactory.createEventDeclProxy(name,
                                         kind,
                                         observable,
                                         scope,
                                         ranges,
                                         colorGeometry);
  }

  public EventListExpressionProxy visitEventListExpressionProxy
    (final EventListExpressionProxy proxy)
    throws VisitorException
  {
    return (EventListExpressionProxy) proxy.acceptVisitor(this);
  }

  public ExpressionProxy visitExpressionProxy
    (final ExpressionProxy proxy)
    throws VisitorException
  {
    return (ExpressionProxy) proxy.acceptVisitor(this);
  }

  public ForeachComponentProxy visitForeachComponentProxy
    (final ForeachComponentProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final SimpleExpressionProxy range0 = proxy.getRange();
    final SimpleExpressionProxy range = visitSimpleExpressionProxy(range0);
    final SimpleExpressionProxy guard0 = proxy.getGuard();
    final SimpleExpressionProxy guard =
      guard0 == null ? null : visitSimpleExpressionProxy(guard0);
    final Collection<Proxy> body0 = proxy.getBody();
    final Collection<Proxy> body = cloneProxyCollection(body0);
    return mFactory.createForeachComponentProxy(name,
                                                range,
                                                guard,
                                                body);
  }

  public ForeachEventAliasProxy visitForeachEventAliasProxy
    (final ForeachEventAliasProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final SimpleExpressionProxy range0 = proxy.getRange();
    final SimpleExpressionProxy range = visitSimpleExpressionProxy(range0);
    final SimpleExpressionProxy guard0 = proxy.getGuard();
    final SimpleExpressionProxy guard =
      guard0 == null ? null : visitSimpleExpressionProxy(guard0);
    final Collection<Proxy> body0 = proxy.getBody();
    final Collection<Proxy> body = cloneProxyCollection(body0);
    return mFactory.createForeachEventAliasProxy(name,
                                                 range,
                                                 guard,
                                                 body);
  }

  public ForeachEventProxy visitForeachEventProxy
    (final ForeachEventProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final SimpleExpressionProxy range0 = proxy.getRange();
    final SimpleExpressionProxy range = visitSimpleExpressionProxy(range0);
    final SimpleExpressionProxy guard0 = proxy.getGuard();
    final SimpleExpressionProxy guard =
      guard0 == null ? null : visitSimpleExpressionProxy(guard0);
    final Collection<Proxy> body0 = proxy.getBody();
    final Collection<Proxy> body = cloneProxyCollection(body0);
    return mFactory.createForeachEventProxy(name,
                                            range,
                                            guard,
                                            body);
  }

  public ForeachProxy visitForeachProxy
    (final ForeachProxy proxy)
    throws VisitorException
  {
    return (ForeachProxy) proxy.acceptVisitor(this);
  }

  public GraphProxy visitGraphProxy
    (final GraphProxy proxy)
    throws VisitorException
  {
    final boolean deterministic = proxy.isDeterministic();
    final LabelBlockProxy blockedEvents0 = proxy.getBlockedEvents();
    final LabelBlockProxy blockedEvents =
      blockedEvents0 == null ? null : visitLabelBlockProxy(blockedEvents0);
    final Collection<NodeProxy> nodes0 = proxy.getNodes();
    final Collection<NodeProxy> nodes = lookupNodeProxyCollection(nodes0);
    final Collection<EdgeProxy> edges0 = proxy.getEdges();
    final Collection<EdgeProxy> edges = cloneProxyCollection(edges0);
    mNodeMap.clear();
    return mFactory.createGraphProxy(deterministic,
                                     blockedEvents,
                                     nodes,
                                     edges);
  }

  public GroupNodeProxy visitGroupNodeProxy
    (final GroupNodeProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final PlainEventListProxy propositions0 = proxy.getPropositions();
    final PlainEventListProxy propositions =
      visitPlainEventListProxy(propositions0);
    final Collection<NodeProxy> immediateChildNodes0 =
      proxy.getImmediateChildNodes();
    final Collection<NodeProxy> immediateChildNodes =
      lookupNodeProxyCollection(immediateChildNodes0);
    final BoxGeometryProxy geometry0 = proxy.getGeometry();
    final BoxGeometryProxy geometry =
      geometry0 == null ? null : visitBoxGeometryProxy(geometry0);
    return mFactory.createGroupNodeProxy(name,
                                         propositions,
                                         immediateChildNodes,
                                         geometry);
  }

  public GuardActionBlockProxy visitGuardActionBlockProxy
    (final GuardActionBlockProxy proxy)
    throws VisitorException
  {
    final Collection<SimpleExpressionProxy> guards0 = proxy.getGuards();
    final Collection<SimpleExpressionProxy> guards =
      cloneProxyCollection(guards0);
    final Collection<BinaryExpressionProxy> actions0 = proxy.getActions();
    final Collection<BinaryExpressionProxy> actions =
      cloneProxyCollection(actions0);
    final LabelGeometryProxy geometry0 = proxy.getGeometry();
    final LabelGeometryProxy geometry =
      geometry0 == null ? null : visitLabelGeometryProxy(geometry0);
    return mFactory.createGuardActionBlockProxy(guards,
                                                actions,
                                                geometry);
  }

  public IdentifiedProxy visitIdentifiedProxy
    (final IdentifiedProxy proxy)
    throws VisitorException
  {
    return (IdentifiedProxy) proxy.acceptVisitor(this);
  }

  public IdentifierProxy visitIdentifierProxy
    (final IdentifierProxy proxy)
    throws VisitorException
  {
    return (IdentifierProxy) proxy.acceptVisitor(this);
  }

  public IndexedIdentifierProxy visitIndexedIdentifierProxy
    (final IndexedIdentifierProxy proxy)
    throws VisitorException
  {
    final String plainText = proxy.getPlainText();
    final String name = proxy.getName();
    final Collection<SimpleExpressionProxy> indexes0 = proxy.getIndexes();
    final Collection<SimpleExpressionProxy> indexes =
      cloneProxyCollection(indexes0);
    return mFactory.createIndexedIdentifierProxy(plainText,
                                                 name,
                                                 indexes);
  }

  public InstanceProxy visitInstanceProxy
    (final InstanceProxy proxy)
    throws VisitorException
  {
    final IdentifierProxy identifier0 = proxy.getIdentifier();
    final IdentifierProxy identifier = visitIdentifierProxy(identifier0);
    final String moduleName = proxy.getModuleName();
    final Collection<ParameterBindingProxy> bindingList0 =
      proxy.getBindingList();
    final Collection<ParameterBindingProxy> bindingList =
      cloneProxyCollection(bindingList0);
    return mFactory.createInstanceProxy(identifier,
                                        moduleName,
                                        bindingList);
  }

  public IntConstantProxy visitIntConstantProxy
    (final IntConstantProxy proxy)
    throws VisitorException
  {
    final String plainText = proxy.getPlainText();
    final int value = proxy.getValue();
    return mFactory.createIntConstantProxy(plainText,
                                           value);
  }

  public LabelBlockProxy visitLabelBlockProxy
    (final LabelBlockProxy proxy)
    throws VisitorException
  {
    final Collection<Proxy> eventList0 = proxy.getEventList();
    final Collection<Proxy> eventList = cloneProxyCollection(eventList0);
    final LabelGeometryProxy geometry0 = proxy.getGeometry();
    final LabelGeometryProxy geometry =
      geometry0 == null ? null : visitLabelGeometryProxy(geometry0);
    return mFactory.createLabelBlockProxy(eventList,
                                          geometry);
  }

  public LabelGeometryProxy visitLabelGeometryProxy
    (final LabelGeometryProxy proxy)
    throws VisitorException
  {
    final Point2D offset = proxy.getOffset();
    final AnchorPosition anchor = proxy.getAnchor();
    return mFactory.createLabelGeometryProxy(offset,
                                             anchor);
  }

  public ModuleProxy visitModuleProxy
    (final ModuleProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final String comment = proxy.getComment();
    final Collection<ConstantAliasProxy> constantAliasList0 =
      proxy.getConstantAliasList();
    final Collection<ConstantAliasProxy> constantAliasList =
      cloneProxyCollection(constantAliasList0);
    final Collection<EventDeclProxy> eventDeclList0 =
      proxy.getEventDeclList();
    final Collection<EventDeclProxy> eventDeclList =
      cloneProxyCollection(eventDeclList0);
    final Collection<Proxy> eventAliasList0 = proxy.getEventAliasList();
    final Collection<Proxy> eventAliasList =
      cloneProxyCollection(eventAliasList0);
    final Collection<Proxy> componentList0 = proxy.getComponentList();
    final Collection<Proxy> componentList =
      cloneProxyCollection(componentList0);
    return mFactory.createModuleProxy(name,
                                      comment,
                                      null,
                                      constantAliasList,
                                      eventDeclList,
                                      eventAliasList,
                                      componentList);
  }

  public NodeProxy visitNodeProxy
    (final NodeProxy proxy)
    throws VisitorException
  {
    return (NodeProxy) proxy.acceptVisitor(this);
  }

  public ParameterBindingProxy visitParameterBindingProxy
    (final ParameterBindingProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final ExpressionProxy expression0 = proxy.getExpression();
    final ExpressionProxy expression = visitExpressionProxy(expression0);
    return mFactory.createParameterBindingProxy(name,
                                                expression);
  }

  public PlainEventListProxy visitPlainEventListProxy
    (final PlainEventListProxy proxy)
    throws VisitorException
  {
    final Collection<Proxy> eventList0 = proxy.getEventList();
    final Collection<Proxy> eventList = cloneProxyCollection(eventList0);
    return mFactory.createPlainEventListProxy(eventList);
  }

  public PointGeometryProxy visitPointGeometryProxy
    (final PointGeometryProxy proxy)
    throws VisitorException
  {
    final Point2D point = proxy.getPoint();
    return mFactory.createPointGeometryProxy(point);
  }

  public Proxy visitProxy
    (final Proxy proxy)
    throws VisitorException
  {
    return (Proxy) proxy.acceptVisitor(this);
  }

  public SimpleComponentProxy visitSimpleComponentProxy
    (final SimpleComponentProxy proxy)
    throws VisitorException
  {
    final IdentifierProxy identifier0 = proxy.getIdentifier();
    final IdentifierProxy identifier = visitIdentifierProxy(identifier0);
    final ComponentKind kind = proxy.getKind();
    final GraphProxy graph0 = proxy.getGraph();
    final GraphProxy graph = visitGraphProxy(graph0);
    final Collection<VariableProxy> variables0 = proxy.getVariables();
    final Collection<VariableProxy> variables =
      cloneProxyCollection(variables0);
    return mFactory.createSimpleComponentProxy(identifier,
                                               kind,
                                               graph,
                                               variables);
  }

  public SimpleExpressionProxy visitSimpleExpressionProxy
    (final SimpleExpressionProxy proxy)
    throws VisitorException
  {
    return (SimpleExpressionProxy) proxy.acceptVisitor(this);
  }

  public SimpleIdentifierProxy visitSimpleIdentifierProxy
    (final SimpleIdentifierProxy proxy)
    throws VisitorException
  {
    final String plainText = proxy.getPlainText();
    final String name = proxy.getName();
    return mFactory.createSimpleIdentifierProxy(plainText,
                                                name);
  }

  public SimpleNodeProxy visitSimpleNodeProxy
    (final SimpleNodeProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final PlainEventListProxy propositions0 = proxy.getPropositions();
    final PlainEventListProxy propositions =
      visitPlainEventListProxy(propositions0);
    final boolean initial = proxy.isInitial();
    final PointGeometryProxy pointGeometry0 = proxy.getPointGeometry();
    final PointGeometryProxy pointGeometry =
      pointGeometry0 == null ? null : visitPointGeometryProxy(pointGeometry0);
    final PointGeometryProxy initialArrowGeometry0 =
      proxy.getInitialArrowGeometry();
    final PointGeometryProxy initialArrowGeometry =
      initialArrowGeometry0 == null ? null : visitPointGeometryProxy(initialArrowGeometry0);
    final LabelGeometryProxy labelGeometry0 = proxy.getLabelGeometry();
    final LabelGeometryProxy labelGeometry =
      labelGeometry0 == null ? null : visitLabelGeometryProxy(labelGeometry0);
    return mFactory.createSimpleNodeProxy(name,
                                          propositions,
                                          initial,
                                          pointGeometry,
                                          initialArrowGeometry,
                                          labelGeometry);
  }

  public SplineGeometryProxy visitSplineGeometryProxy
    (final SplineGeometryProxy proxy)
    throws VisitorException
  {
    final Collection<Point2D> points = proxy.getPoints();
    final SplineKind kind = proxy.getKind();
    return mFactory.createSplineGeometryProxy(points,
                                              kind);
  }

  public UnaryExpressionProxy visitUnaryExpressionProxy
    (final UnaryExpressionProxy proxy)
    throws VisitorException
  {
    final String plainText = proxy.getPlainText();
    final UnaryOperator operator = proxy.getOperator();
    final SimpleExpressionProxy subTerm0 = proxy.getSubTerm();
    final SimpleExpressionProxy subTerm =
      visitSimpleExpressionProxy(subTerm0);
    return mFactory.createUnaryExpressionProxy(plainText,
                                               operator,
                                               subTerm);
  }

  public VariableComponentProxy visitVariableComponentProxy
    (final VariableComponentProxy proxy)
    throws VisitorException
  {
    final IdentifierProxy identifier0 = proxy.getIdentifier();
    final IdentifierProxy identifier = visitIdentifierProxy(identifier0);
    final SimpleExpressionProxy type0 = proxy.getType();
    final SimpleExpressionProxy type = visitSimpleExpressionProxy(type0);
    final boolean deterministic = proxy.isDeterministic();
    final SimpleExpressionProxy initialStatePredicate0 =
      proxy.getInitialStatePredicate();
    final SimpleExpressionProxy initialStatePredicate =
      visitSimpleExpressionProxy(initialStatePredicate0);
    final Collection<VariableMarkingProxy> variableMarkings0 =
      proxy.getVariableMarkings();
    final Collection<VariableMarkingProxy> variableMarkings =
      cloneProxyCollection(variableMarkings0);
    return mFactory.createVariableComponentProxy(identifier,
                                                 type,
                                                 deterministic,
                                                 initialStatePredicate,
                                                 variableMarkings);
  }

  public VariableMarkingProxy visitVariableMarkingProxy
    (final VariableMarkingProxy proxy)
    throws VisitorException
  {
    final IdentifierProxy proposition0 = proxy.getProposition();
    final IdentifierProxy proposition = visitIdentifierProxy(proposition0);
    final SimpleExpressionProxy predicate0 = proxy.getPredicate();
    final SimpleExpressionProxy predicate =
      visitSimpleExpressionProxy(predicate0);
    return mFactory.createVariableMarkingProxy(proposition,
                                               predicate);
  }

  public VariableProxy visitVariableProxy
    (final VariableProxy proxy)
    throws VisitorException
  {
    final String name = proxy.getName();
    final SimpleExpressionProxy type0 = proxy.getType();
    final SimpleExpressionProxy type = visitSimpleExpressionProxy(type0);
    final SimpleExpressionProxy initialValue0 = proxy.getInitialValue();
    final SimpleExpressionProxy initialValue =
      visitSimpleExpressionProxy(initialValue0);
    final SimpleExpressionProxy markedValue0 = proxy.getMarkedValue();
    final SimpleExpressionProxy markedValue =
      markedValue0 == null ? null : visitSimpleExpressionProxy(markedValue0);
    return mFactory.createVariableProxy(name,
                                        type,
                                        initialValue,
                                        markedValue);
  }


  //#########################################################################
  //# Auxiliary Methods
  private NodeProxy lookupNodeProxy(final NodeProxy orig)
    throws VisitorException
  {
    final String name = orig.getName();
    NodeProxy node = mNodeMap.get(name);
    if (node == null) {
      node = visitNodeProxy(orig);
      mNodeMap.put(name, node);
    }
    return node;
  }

  private Collection<NodeProxy> lookupNodeProxyCollection
    (final Collection<? extends NodeProxy> orig)
    throws VisitorException
  {
    final Collection<NodeProxy> result = new LinkedList<NodeProxy>();
    for (final NodeProxy orignode : orig) {
      final NodeProxy resnode = lookupNodeProxy(orignode);
      result.add(resnode);
    }
    return result;
  }

  private <P extends Proxy>
  Collection<P> cloneProxyCollection(final Collection<P> orig)
    throws VisitorException
  {
    final Collection<Proxy> result = new LinkedList<Proxy>();
    for (final Proxy origelem : orig) {
      final Proxy reselem = (Proxy) origelem.acceptVisitor(this);
      result.add(reselem);
    }
    return Casting.toCollection(result);
  }


  //#########################################################################
  //# Data Members
  private final ModuleProxyFactory mFactory;
  private final Map<String,NodeProxy> mNodeMap;

}
