package org.supremica.external.operationframeworkto61131.main;

/***************************************************
 * GUI.java
 * GUI for Liu Chaos PLCopenXML code generator
 * Created on 2008-nov-25, 14:35:53
 */
/**
 * @author Martin Fabian
 */

import java.io.File;
import javax.swing.Box;
import javax.swing.BoxLayout;
import javax.swing.JCheckBox;
import javax.swing.JFileChooser;
import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTextField;
import javax.swing.UIManager;
import javax.swing.filechooser.FileNameExtensionFilter;

public class GUI extends javax.swing.JFrame {
	// This nested class just collects all info, use getInfo()
	// All variables are read only
	// If Include manual edits is off, then ManualInputPathName is null
	// If GenerateVariableList is off, then infoChoices is null;
	public class Info {
		private Info(String s1, String s2, String s3, JCheckBox jbx[]) {
			this.InputFilePathName = s1;
			this.OutputFilePathnAme = s2;
			this.ManualFilePathName = s3;
			this.infoChoices = jbx;
		}

		final String InputFilePathName;
		final String OutputFilePathnAme;
		final String ManualFilePathName;
		final JCheckBox infoChoices[];
	}

	JTextArea outputTextArea = new JTextArea(5, 20);

	final static String THE_NAME = "PLCopenXML Code Generator";
	final static String THE_VERSION = "v.0";
	final static String DEF_FILE_NAME = "PLCopenCode";
	final static String DEF_FILE_EXT = "xml";
	final static String DEF_FILE_DESC = "XML Files";

	final static boolean CHECKED = true;
	final static boolean UNCHECKED = false;

	// Add choices as JCheckBox'es here
	// Boxes will appear in the order they are defined
	// The state of a JCheckBox is determined by JCheckBox.isSelected()

	JCheckBox[] infoChoices = new JCheckBox[org.supremica.external.operationframeworkto61131.builder.VariableListBuilder.columns.length + 1];

	/** Creates new form JCiao */
	public GUI() {

		super(THE_NAME + " " + THE_VERSION);

		initComponents();

		// Create rudimentary Help menu, flush right
		JMenu helpMenu = new JMenu("Help");
		JMenuItem aboutItem = new JMenuItem("About...");
		aboutItem.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				AboutItemActionPerformed(evt);
			}
		});
		helpMenu.add(aboutItem);
		MenuBar.add(Box.createHorizontalGlue()); // to flush right
		MenuBar.add(helpMenu);

		outputTextArea.setEditable(false);
		JScrollPane outputTextAreaScrollPane = new JScrollPane(outputTextArea);

		initVariableListCheckBoxs();
		JPanel checkBoxPanel = new JPanel();
		checkBoxPanel.setLayout(new BoxLayout(checkBoxPanel, BoxLayout.Y_AXIS));
		for (JCheckBox box : infoChoices) {
			box.setEnabled(GenerateVariableList.isSelected());
			checkBoxPanel.add(box);
		}

		checkBoxPanel.add(outputTextAreaScrollPane);
		VariableListPane.setViewportView(checkBoxPanel);
	}

	private void AboutItemActionPerformed(java.awt.event.ActionEvent evt) {
		// Throw up a dialog listing our names
		JOptionPane.showMessageDialog(this, THE_NAME + " " + THE_VERSION + "\n"
				+ "Created by:\n"
				+ "Liu Chao, Johan Richardsson, Martin Fabian\n"
				+ "Chalmers University of Technology, Göteborg, Sweden",
				"About", JOptionPane.INFORMATION_MESSAGE);
	}

	private void ManageDirectorySelection(JTextField text_field) {
		JFileChooser chooser = new JFileChooser();
		chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);

		if (chooser.showOpenDialog(this) == JFileChooser.APPROVE_OPTION) {
			text_field.setText(chooser.getSelectedFile().getAbsolutePath());
		}

	}

	private void ManageFileSelection(JTextField text_field) {
		String file_path = text_field.getText();
		if ((file_path == null) || (file_path.equals(""))) {
			file_path = DEF_FILE_NAME + "." + DEF_FILE_EXT;
		}
		JFileChooser chooser = new JFileChooser();
		// chooser.setSelectedFile(new File(file_path));
		// chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
		// // chooser.setFileSelectionMode(JFileChooser.FILES_AND_DIRECTORIES);
		FileNameExtensionFilter filter = new FileNameExtensionFilter(
				DEF_FILE_DESC, DEF_FILE_EXT);
		chooser.setFileFilter(filter);
		if (chooser.showOpenDialog(this) == JFileChooser.APPROVE_OPTION) {
			text_field.setText(chooser.getSelectedFile().getAbsolutePath());
		}

	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
	// <editor-fold defaultstate="collapsed"
	// desc="Generated Code">//GEN-BEGIN:initComponents
	private void initComponents() {

		GoButton = new javax.swing.JButton();
		CancelButton = new javax.swing.JButton();
		OutputFilePathName = new javax.swing.JTextField();
		OutputFileBrowse = new javax.swing.JButton();
		jLabel1 = new javax.swing.JLabel();
		ManualEditsPathName = new javax.swing.JTextField();
		ManualEditsBrowse = new javax.swing.JButton();
		jLabel2 = new javax.swing.JLabel();
		IncludeManualEdits = new javax.swing.JCheckBox();
		GenerateVariableList = new javax.swing.JCheckBox();
		VariableListPane = new javax.swing.JScrollPane();
		jLabel3 = new javax.swing.JLabel();
		jLabel4 = new javax.swing.JLabel();
		InputFilePathName = new javax.swing.JTextField();
		InputFileBrowse = new javax.swing.JButton();
		MenuBar = new javax.swing.JMenuBar();

		setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
		setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));

		GoButton.setText("Go!");
		GoButton.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				GoButtonActionPerformed(evt);
			}
		});

		CancelButton.setText("Cancel");
		CancelButton.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				CancelButtonActionPerformed(evt);
			}
		});

		OutputFileBrowse.setText("...");
		OutputFileBrowse.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				OutputFileBrowseActionPerformed(evt);
			}
		});

		jLabel1.setText("XML Output Directory");

		ManualEditsPathName.setEnabled(false);

		ManualEditsBrowse.setText("...");
		ManualEditsBrowse.setEnabled(false);
		ManualEditsBrowse
				.addActionListener(new java.awt.event.ActionListener() {
					public void actionPerformed(java.awt.event.ActionEvent evt) {
						ManualEditsBrowseActionPerformed(evt);
					}
				});

		jLabel2.setText("Manual Edits");

		IncludeManualEdits.setText("Include manual edits");
		IncludeManualEdits
				.addActionListener(new java.awt.event.ActionListener() {
					public void actionPerformed(java.awt.event.ActionEvent evt) {
						IncludeManualEditsActionPerformed(evt);
					}
				});

		GenerateVariableList.setSelected(true);
		GenerateVariableList.setText("Generate variable list");
		GenerateVariableList
				.addActionListener(new java.awt.event.ActionListener() {
					public void actionPerformed(java.awt.event.ActionEvent evt) {
						GenerateVariableListActionPerformed(evt);
					}
				});

		jLabel3.setText("Variable List");

		jLabel4.setText("XML Intput File Directory (\"database\")");

		InputFileBrowse.setText("...");
		InputFileBrowse.addActionListener(new java.awt.event.ActionListener() {
			public void actionPerformed(java.awt.event.ActionEvent evt) {
				InputFileBrowseActionPerformed(evt);
			}
		});
		setJMenuBar(MenuBar);

		javax.swing.GroupLayout layout = new javax.swing.GroupLayout(
				getContentPane());
		getContentPane().setLayout(layout);
		layout
				.setHorizontalGroup(layout
						.createParallelGroup(
								javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(
								layout
										.createSequentialGroup()
										.addGroup(
												layout
														.createParallelGroup(
																javax.swing.GroupLayout.Alignment.TRAILING)
														.addGroup(
																layout
																		.createSequentialGroup()
																		.addContainerGap()
																		.addComponent(
																				GenerateVariableList))
														.addGroup(
																javax.swing.GroupLayout.Alignment.LEADING,
																layout
																		.createParallelGroup(
																				javax.swing.GroupLayout.Alignment.LEADING)
																		.addGroup(
																				layout
																						.createSequentialGroup()
																						.addGap(
																								29,
																								29,
																								29)
																						.addGroup(
																								layout
																										.createParallelGroup(
																												javax.swing.GroupLayout.Alignment.LEADING)
																										.addComponent(
																												VariableListPane,
																												javax.swing.GroupLayout.DEFAULT_SIZE,
																												265,
																												Short.MAX_VALUE)
																										.addGroup(
																												layout
																														.createSequentialGroup()
																														.addComponent(
																																ManualEditsPathName,
																																javax.swing.GroupLayout.DEFAULT_SIZE,
																																212,
																																Short.MAX_VALUE)
																														.addPreferredGap(
																																javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																														.addComponent(
																																ManualEditsBrowse))
																										.addGroup(
																												layout
																														.createSequentialGroup()
																														.addComponent(
																																jLabel2)
																														.addPreferredGap(
																																javax.swing.LayoutStyle.ComponentPlacement.RELATED,
																																82,
																																Short.MAX_VALUE)
																														.addComponent(
																																IncludeManualEdits))
																										.addComponent(
																												jLabel3)
																										.addComponent(
																												jLabel1)
																										.addGroup(
																												layout
																														.createSequentialGroup()
																														.addComponent(
																																OutputFilePathName,
																																javax.swing.GroupLayout.PREFERRED_SIZE,
																																212,
																																javax.swing.GroupLayout.PREFERRED_SIZE)
																														.addPreferredGap(
																																javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																														.addComponent(
																																OutputFileBrowse))
																										.addComponent(
																												jLabel4)
																										.addGroup(
																												layout
																														.createSequentialGroup()
																														.addComponent(
																																InputFilePathName,
																																javax.swing.GroupLayout.PREFERRED_SIZE,
																																212,
																																javax.swing.GroupLayout.PREFERRED_SIZE)
																														.addPreferredGap(
																																javax.swing.LayoutStyle.ComponentPlacement.RELATED)
																														.addComponent(
																																InputFileBrowse))))
																		.addGroup(
																				layout
																						.createSequentialGroup()
																						.addGap(
																								92,
																								92,
																								92)
																						.addComponent(
																								GoButton,
																								javax.swing.GroupLayout.PREFERRED_SIZE,
																								71,
																								javax.swing.GroupLayout.PREFERRED_SIZE)
																						.addPreferredGap(
																								javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
																						.addComponent(
																								CancelButton))))
										.addContainerGap(33, Short.MAX_VALUE)));
		layout
				.setVerticalGroup(layout
						.createParallelGroup(
								javax.swing.GroupLayout.Alignment.LEADING)
						.addGroup(
								layout
										.createSequentialGroup()
										.addGap(26, 26, 26)
										.addComponent(jLabel4)
										.addPreferredGap(
												javax.swing.LayoutStyle.ComponentPlacement.RELATED)
										.addGroup(
												layout
														.createParallelGroup(
																javax.swing.GroupLayout.Alignment.BASELINE)
														.addComponent(
																InputFilePathName,
																javax.swing.GroupLayout.PREFERRED_SIZE,
																javax.swing.GroupLayout.DEFAULT_SIZE,
																javax.swing.GroupLayout.PREFERRED_SIZE)
														.addComponent(
																InputFileBrowse))
										.addGap(18, 18, 18)
										.addGroup(
												layout
														.createParallelGroup(
																javax.swing.GroupLayout.Alignment.BASELINE)
														.addComponent(jLabel2)
														.addComponent(
																IncludeManualEdits))
										.addPreferredGap(
												javax.swing.LayoutStyle.ComponentPlacement.RELATED)
										.addGroup(
												layout
														.createParallelGroup(
																javax.swing.GroupLayout.Alignment.BASELINE)
														.addComponent(
																ManualEditsPathName,
																javax.swing.GroupLayout.PREFERRED_SIZE,
																javax.swing.GroupLayout.DEFAULT_SIZE,
																javax.swing.GroupLayout.PREFERRED_SIZE)
														.addComponent(
																ManualEditsBrowse))
										.addGap(18, 18, 18)
										.addComponent(jLabel1)
										.addPreferredGap(
												javax.swing.LayoutStyle.ComponentPlacement.RELATED)
										.addGroup(
												layout
														.createParallelGroup(
																javax.swing.GroupLayout.Alignment.BASELINE)
														.addComponent(
																OutputFilePathName,
																javax.swing.GroupLayout.PREFERRED_SIZE,
																javax.swing.GroupLayout.DEFAULT_SIZE,
																javax.swing.GroupLayout.PREFERRED_SIZE)
														.addComponent(
																OutputFileBrowse))
										.addGap(24, 24, 24)
										.addGroup(
												layout
														.createParallelGroup(
																javax.swing.GroupLayout.Alignment.BASELINE)
														.addComponent(
																GenerateVariableList)
														.addComponent(jLabel3))
										.addPreferredGap(
												javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
										.addComponent(
												VariableListPane,
												javax.swing.GroupLayout.PREFERRED_SIZE,
												317,
												javax.swing.GroupLayout.PREFERRED_SIZE)
										.addPreferredGap(
												javax.swing.LayoutStyle.ComponentPlacement.RELATED,
												42, Short.MAX_VALUE)
										.addGroup(
												layout
														.createParallelGroup(
																javax.swing.GroupLayout.Alignment.BASELINE)
														.addComponent(GoButton)
														.addComponent(
																CancelButton))
										.addGap(29, 29, 29)));

		pack();
	}// </editor-fold>//GEN-END:initComponents

	@SuppressWarnings("deprecation")
	private void GoButtonActionPerformed(java.awt.event.ActionEvent evt)// GEN-FIRST:event_GoButtonActionPerformed
	{// GEN-HEADEREND:event_GoButtonActionPerformed
		
		
		

		// ** This is just for testing/debugging
		Info info = getInfo();
		System.out.println("InputFilePathName: " + info.InputFilePathName);
		System.out.println("OutputFilePathName: " + info.OutputFilePathnAme);
		System.out.println("ManualFilePathName: "
				+ (info.ManualFilePathName != null ? info.ManualFilePathName
						: "Deselected"));
		System.out.println("VariableInfoList:");
		if (info.infoChoices != null) {
			for (JCheckBox box : info.infoChoices) {
				System.out.println(box.getText()
						+ (box.isSelected() ? " yes" : " no"));
			}
		} else
			System.out.println("Deselected");

		// ** Here we call the program with the user supplied information

		// plcopenBuilder.start(info.InputFilePathName, info.OutputFilePathnAme,
		// info.ManualFilePathName, info.infoChoices, outputTextArea);
		

	
		new PLCopenXMLConverter().start(info.InputFilePathName,
				info.OutputFilePathnAme, info.ManualFilePathName,
				info.infoChoices, outputTextArea);
				

	}// GEN-LAST:event_GoButtonActionPerformed

	private void initVariableListCheckBoxs() {

		infoChoices[0] = new JCheckBox("Only external variables", UNCHECKED);

		for (int i = 1; i < infoChoices.length; i++)

		{

			infoChoices[i] = new JCheckBox(
					org.supremica.external.operationframeworkto61131.builder.VariableListBuilder.columns[i - 1],
					CHECKED);

		}
		;
	}

	private void IncludeManualEditsActionPerformed(
			java.awt.event.ActionEvent evt)// GEN-FIRST:event_IncludeManualEditsActionPerformed
	{// GEN-HEADEREND:event_IncludeManualEditsActionPerformed
		boolean manual_edits_state = IncludeManualEdits.isSelected();
		ManualEditsBrowse.setEnabled(manual_edits_state);
		ManualEditsPathName.setEnabled(manual_edits_state);
	}// GEN-LAST:event_IncludeManualEditsActionPerformed

	private void OutputFileBrowseActionPerformed(java.awt.event.ActionEvent evt)// GEN-FIRST:event_OutputFileBrowseActionPerformed
	{// GEN-HEADEREND:event_OutputFileBrowseActionPerformed
		ManageDirectorySelection(OutputFilePathName);
	}// GEN-LAST:event_OutputFileBrowseActionPerformed

	private void ManualEditsBrowseActionPerformed(java.awt.event.ActionEvent evt)// GEN-FIRST:event_ManualEditsBrowseActionPerformed
	{// GEN-HEADEREND:event_ManualEditsBrowseActionPerformed
		ManageFileSelection(ManualEditsPathName);
	}// GEN-LAST:event_ManualEditsBrowseActionPerformed

	private void CancelButtonActionPerformed(java.awt.event.ActionEvent evt)// GEN-FIRST:event_CancelButtonActionPerformed
	{// GEN-HEADEREND:event_CancelButtonActionPerformed
		System.exit(0);
	}// GEN-LAST:event_CancelButtonActionPerformed

	private void InputFileBrowseActionPerformed(java.awt.event.ActionEvent evt)// GEN-FIRST:event_InputFileBrowseActionPerformed
	{// GEN-HEADEREND:event_InputFileBrowseActionPerformed
		ManageDirectorySelection(InputFilePathName);
	}// GEN-LAST:event_InputFileBrowseActionPerformed

	private void GenerateVariableListActionPerformed(
			java.awt.event.ActionEvent evt)// GEN-FIRST:event_GenerateVariableListActionPerformed
	{// GEN-HEADEREND:event_GenerateVariableListActionPerformed
		for (JCheckBox box : infoChoices) {
			box.setEnabled(GenerateVariableList.isSelected());
		}
	}// GEN-LAST:event_GenerateVariableListActionPerformed

	Info getInfo() {
		return new Info(InputFilePathName.getText(), OutputFilePathName
				.getText(),
				(IncludeManualEdits.isSelected() ? ManualEditsPathName
						.getText() : null),
				(GenerateVariableList.isSelected() ? infoChoices : null));

	}

	/**
	 * @param args
	 *            the command line arguments
	 */
	public static void main(String args[]) {
		try {
			UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
		} catch (Exception excp) {
			// Let it silently die...
			System.exit(0);
		}
		/*
		 * Could do some command line processing, but not now... // process
		 * command line, only "<cfg-file-name>" allowed final String
		 * cfg_file_name = (args.length > 0) ? args[0] : DEF_CFG_FILE_NAME;
		 */
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				new GUI().setVisible(true);
			}
		});
	}

	// Variables declaration - do not modify//GEN-BEGIN:variables
	private javax.swing.JButton CancelButton;
	private javax.swing.JCheckBox GenerateVariableList;
	private javax.swing.JButton GoButton;
	private javax.swing.JCheckBox IncludeManualEdits;
	private javax.swing.JButton InputFileBrowse;
	private javax.swing.JTextField InputFilePathName;
	private javax.swing.JButton ManualEditsBrowse;
	private javax.swing.JTextField ManualEditsPathName;
	private javax.swing.JMenuBar MenuBar;
	private javax.swing.JButton OutputFileBrowse;
	private javax.swing.JTextField OutputFilePathName;
	private javax.swing.JScrollPane VariableListPane;
	private javax.swing.JLabel jLabel1;
	private javax.swing.JLabel jLabel2;
	private javax.swing.JLabel jLabel3;
	private javax.swing.JLabel jLabel4;
	// End of variables declaration//GEN-END:variables

}
