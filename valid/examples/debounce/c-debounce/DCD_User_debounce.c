/*****************************************************************************
** Generated by DES-to-C-Generator, Revision 2.5C
** Thu Dec 09 20:24:42 1999
** (C) Siemens AG, ZT SE 4, 1999. All Rights Reserved.
** Authors: Dr. Markus Kaltenbach, Dr. Robi Malik
*****************************************************************************/

#ifdef __GNUG__
#pragma implementation
#endif

#include <stdio.h>

#include "DCD_Project_debounce.h"


/*****************************************************************************
** DCD_Project_debounce: General Object Handling
*****************************************************************************/

void DCD_Project_debounce_create(DCD_Project_debounce* project)
{
  DCD_Automaton_create(&project->mAutomaton);
  DCD_States_debounce_init(&project->mStates);
  project->mLastKey = 0;
  project->mTime = -1;
}


void DCD_Project_debounce_destroy(DCD_Project_debounce* project)
{
  DCD_Automaton_destroy(&project->mAutomaton);
}


void DCD_Project_debounce_init(DCD_Project_debounce* project)
{
  DCD_Automaton_init(&project->mAutomaton);
  DCD_States_debounce_init(&project->mStates);
  project->mLastKey = 0;
  project->mTime = -1;
}


/*****************************************************************************
** DCD_Project_debounce: User-defined Execution Method
*****************************************************************************/

#define TIMEOUT 5

void DCD_Project_debounce_execute(DCD_Project_debounce* project)
{
  // Loop forever ...
  for (;;) {
    // 1.) Read uncontrollables from keyboard and signal them:
    char buffer[1024];
    char key;
    fprintf(stdout, "New input: ");
    fflush(stdout);
    if (gets(buffer) == 0) {
      fprintf(stdout, "<QUIT>\n");
      break;
    }
    key = buffer[0];
    if (key != project->mLastKey) {
      DCD_Project_debounce_Signal_new_value(project, 1);
      project->mLastKey = key;
    }
    if (project->mTime >= 0) {
      if (++project->mTime == TIMEOUT) {
        DCD_Project_debounce_Signal_timeout(project, 1);
      }
    }
    // 2.) Perform automaton step by calling superclass method:
    DCD_Project_debounce_step(project);
  }
}


/*****************************************************************************
** Code fragment for event: timeout
*****************************************************************************/

void DCD_Project_debounce_Action_timeout
    (DCD_Project_debounce* project, int bit)
{
  if (bit == 1) {
    project->mTime = -1;
  }
}


/*****************************************************************************
** Code fragment for event: chg_value
*****************************************************************************/

void DCD_Project_debounce_Action_chg_value
    (DCD_Project_debounce* project, int bit)
{
  if (bit == 1) {
    fprintf(stdout, "*** Value HAS changed ***\n");
  }
}


/*****************************************************************************
** Code fragment for event: reset
*****************************************************************************/

void DCD_Project_debounce_Action_reset
    (DCD_Project_debounce* project, int bit)
{
  if (bit == 1) {
    project->mTime = -1;
  }
}


/*****************************************************************************
** Code fragment for event: timer
*****************************************************************************/

void DCD_Project_debounce_Action_timer
    (DCD_Project_debounce* project, int bit)
{
  if (bit == 1) {
    project->mTime = 0;
  }
}


