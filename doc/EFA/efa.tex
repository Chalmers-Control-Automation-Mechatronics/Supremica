\documentclass{article}

\usepackage{amsthm,amsmath,amssymb}

\newtheorem{theorem}{Theorem}


\begin{document}
\tableofcontents
\section{Introduction}

\subsection{Background}

\section{Extended Finite Automaton (EFA)}
An Extended Deterministic Finite Automaton (EFA) is an
augmentation of a regular finite automaton. The regular automaton
$A$ is defined as $A=\langle Q,\Sigma,\delta, q_i,Q_m \rangle$.
Let $T=\{(q,\sigma)\in Q \times \Sigma: \delta(q,\sigma)!\}$
denote the set of transitions in the deterministic automaton $A$
and let $\tau_k$, $k=1,...,|T|$ denote the elements (transitions)
of $T$.

The automaton $A$ is extended by a vector $X=(x_1,...,x_n)$ of $n$
finite integer variables $x_{k}$ and by a $|T|$-tuple of function
pairs $G=\big((g_{\tau_1},a_{\tau_1}),...,
(g_{\tau_{|T|}},a_{\tau_{|T|}})\big)$, where each pair
$(g_{\tau_k},a_{\tau_k})$ is associated to the corresponding
transition $\tau_k$ in $T$. $g_{\tau_k}$ is an evaluation of a
boolean formula (a guard formula) of $X$ i.e.
$g_{\tau_k}:{\mathbb{N}}^{n}\rightarrow \{0,1\}$ saying if the
corresponding transition $\tau_k$ is enabled or not. $a_{\tau_k}$
is an updating (action) function from ${\mathbb{N}}^{n}$ to
${\mathbb{N}}^{n}$ of the integer variables $X=(x_1,...,x_n)$.

With the above notations we will formally define an EFA as the
$8$-tuple $A_{e}=\langle Q, \Sigma, \delta_{e}, q_i, Q_m, X, G
,X_m \rangle$, where $X_m$ are the marked integer values of the
variables in $X$ and $\delta_{e}: Q \times \Sigma \times
{\mathbb{N}}^{n} \rightarrow Q\times {\mathbb{N}}^{n} $ is a new
extended version of the transition function $\delta:Q \times
\Sigma \rightarrow Q$. The extended transition function $\delta_e$
is defined by means of $\delta$ and the elements of $G$ as
\begin{eqnarray}
\delta_{e}(q,\sigma,X)=\left\{
\begin{array}{ll}
(\delta(q,\sigma),a_{q \sigma}(X)\big)\quad\quad g_{q \sigma}(X)=1\\
\textrm{undefined} \quad\quad\quad\quad\quad g_{q \sigma}(X)=0
\end{array}\right.
\end{eqnarray}
If $(q,\sigma)\notin T$ then $g_{q\sigma}$ is undefined and
therefore $\delta_{e}(q,\sigma,X)$ is undefined. Notice that for
the set of transitions $T_e$ in the extended automaton $A_e$ we
have $T_e=\{(q,\sigma)\in Q \times \Sigma: g_{q\sigma}(X)=1
\textrm{ for some } X\}\subset \{(q,\sigma)\in Q \times \Sigma:
g_{q\sigma} \textrm{ is defined } \}\ =T$.



\subsection{Synchronous composition of EFA's}
The synchronous composition of two EFA's $A=\langle Q^A, \Sigma^A,
\delta^A, q^A_i, Q^A_m, X^{A}, G^A, X^A_m \rangle$ and $B=\langle
Q^B, \Sigma^B, \delta^B, q^B_i, Q^B_m, X^{B}, G^B, X^B_m \rangle$
exists if and only if the automata are consistent. The consistency
condition requires that the action functions triggered by a common
enabled event $\sigma\in \Sigma_{A}\cap \Sigma_{B}$ in the two
automata update common variables to the same values, i.e. if the
$i^{ith}$ variable in $X^{A}$ and the $j^{ith}$ variable in
$X^{B}$ are the same variable and $g_{q^A \sigma}(X^{A})\wedge
g_{q^B \sigma}(X^{B})=1$ where $(q^A,q^B)\in Q^A\times Q^B$ then
$(a_{q^A \sigma}(X^{A}))_i = (a_{q^B \sigma}(X^{B}))_j$.

The consistency condition can be verified by inspection. However,
if the vectors $X^{A}$ or $X^{B}$ disable the corresponding guard
formula ($g_{q^A \sigma}(X^{A})\wedge g_{q^B \sigma}(X^{B})$) it
may happen that $a_{q^A \sigma}(X^{A}))_i \neq (a_{q^B
\sigma}(X^{B}))_j$ even though the two automata are consistent.
Therefore it may be a time-consuming task to verify the
consistency condition by inspection. In section
\ref{Implementation} we will present algorithms that includes a
consistency check of the synchronous
composition of two EFA's. \\



 Formally we define the synchronous product $A||B$ of two EFA's
$A=\langle Q^A, \Sigma^A, \delta^A, q^A_i, Q^A_m, X^{A}, G^A,X^A_m
\rangle$ and $B=\langle Q^B, \Sigma^B, \delta^B, q^B_i, Q^B_m,
X^{B}, G^B,X^B_m
 \rangle$ as
\begin{eqnarray}
A||B=\langle Q^A\times Q^B, \Sigma^A \cup \Sigma^B , \delta, q_i,
Q^A_m\times Q^B_m, Z, G, Z_m \rangle.
\end{eqnarray}
To define the integer variables, the guard functions, the action
functions and the transition function for the product we make use
of the corresponding elements in $A$ and $B$.

 Let $Z^{AB}$ denote the common variables of $X^{A}$ and $X^{B}$, and let $Z^A$
and $Z^B$ be the distinct variables of $X^{A}$ and $X^{B}$,
respectively. We define the integer variables $Z$ of the
synchronous product of $A$ and $B$ as the vector $Z=(Z^A, Z^{AB},
Z^B)$. The guard functions $g_{q \sigma}(Z)$ are defined as
\begin{eqnarray}\label{guard_sync_1}
g_{q \sigma}(Z)=\left\{
\begin{array}{ll}
g_{q^A\sigma}(X^{A})\wedge g_{q^B\sigma}(X^{B}) \textrm{ if }\sigma\in \Sigma^A \cap \Sigma^B\\
g_{q^A\sigma}(X^{A}) \quad\quad \textrm{ if } \sigma\in \Sigma^A \setminus \Sigma^B\\
g_{q^B\sigma}(X^{B}) \quad\quad \textrm{ if }
\sigma\in\Sigma^B\setminus \Sigma^A
\end{array}\right.
\end{eqnarray}
If any one of the guards functions in the above definition are
undefined the guard function for the product $g_{q \sigma}$ is
also undefined. To simplify the notation further, we use "dummy"
guard functions in the following way. If $\sigma\in \Sigma^A
\setminus \Sigma^B$ we introduce fictional guards functions
$g_{q^B\sigma}(.)=1$ for $B$ and if $\sigma\in\Sigma^B\setminus
\Sigma^A$ we set $g_{q^A\sigma}(.)=1$. With this convention we can
write equation (\ref{guard_sync_1}) as
\begin{eqnarray}
g_{q \sigma}(Z)= g_{q^A\sigma}(X^{A})\wedge g_{q^B\sigma}(X^{B}).
\end{eqnarray}
To define the action functions for $A||B$ we look at the
restrictions of the updating functions $a^A_\delta$ and
$a^B_\delta$ to the sets $Z^A$ and $Z^B$. The updating functions
are defined as (if $X^{A}$ and $X^{B}$ have no common variables
then $Z^A=X^{A}$ and $Z^B=X^{B}$)
\begin{eqnarray}
a_{q \sigma}(Z)=\left\{
\begin{array}{ll}
 \big(a^A_{q^A \sigma}(X^{A}), a^B_{q^B \sigma}(Z^{B})\big)\quad\quad\sigma\in \Sigma^A \cap \Sigma^B\\
\big(a^A_{q^A \sigma}(X^{A}), Z^{B}\big)\quad\quad\quad\sigma\in \Sigma^A \setminus \Sigma^B\\
\big(Z^{A}, a^B_{q^B \sigma}(X^{B})\big)\quad\quad\quad\sigma\in
\Sigma^B \setminus \Sigma^A
\end{array}\right.
\end{eqnarray}
As in the definition of the guard functions the notion of being
undefined is inherited from the action functions of $A$ and $B$.
Similar to the "dummy" guard functions we introduce fictional
action functions. If $\sigma\in \Sigma^A \setminus \Sigma^B$ we
introduce fictional action functions $a_{q^B\sigma}(X^B)=X^B$ for
$B$ and if $\sigma\in\Sigma^B\setminus \Sigma^A$ we set
$a_{q^A\sigma}(X^A)=X^A$. If $X^{A}$ and $X^{B}$ have no common
variables then the formula for the action functions of the product
simplifies to
\begin{eqnarray}
a_{q \sigma}(Z)=
 \big(a^A_{q^A \sigma}(X^{A}), a^B_{q^B \sigma}(X^{B})\big).
\end{eqnarray}


 The transition function
$\delta(q,\sigma,Z)$ is defined from $\delta^A$ and $\delta^B$ as
\begin{eqnarray}
\delta(q,\sigma,Z)=\left\{
\begin{array}{ll}
\big(\delta^A(q^A,\sigma),\delta^B(q^B,\sigma),a_{q \sigma}(Z)\big) \quad\quad \sigma\in \Sigma^A \cap \Sigma^B \quad g_{q \sigma}(Z)=1\\
\big(\delta^A(q^A,\sigma),q^B,a_{q \sigma}(Z)\big) \quad\quad\quad\quad\quad \sigma\in \Sigma^A \setminus \Sigma^B \quad g_{q \sigma}(Z)=1\\
\big(q^A,\delta^B(q^B,\sigma),a_{q \sigma}(Z)\big) \quad\quad\quad\quad\quad \sigma\in \Sigma^B \setminus \Sigma^A \quad g_{q \sigma}(Z)=1\\
\textrm{
undefined}\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad
g_{q\sigma}(Z)=0
\end{array}\right.
\end{eqnarray}

The synchronous product $A||B$ of two FSA $A$ and $B$ can be
extended to $(A||B)_e$ by taking the synchronous product of the
extended components  $A_e$ and $B_e$. In other words, the
operations extension and product commute, $(A||B)_e=A_e||B_e$.

Moreover, by the above definition of synchronization we now obtain
the following property

\begin{theorem}
   Full synchronous composition of EFAs is an associative
   operation.
\end{theorem}

\noindent \textbf{Proof}: To prove this associativity we
considering three automata $A, A'$ and $A''$, and show that
$(A\|A')\|A'' = A\|(A'\|A'')$. First, we assume that the three
automata have no common variables.
\newline\newline
\noindent The 8-tuple representing $(A\|A')\|A''$ is
\begin{center}
\begin{tabular}{ll}
  $(A\|A')\|A'' =$ & $\Big \langle (Q \times Q') \times Q'',$\\
  & $ \big(\Sigma \bigcup \Sigma' \big) \bigcup \Sigma'',$\\
  & $\delta^{(A\|A')\|A''},$\\
  & $\big((q_i, q'_i) , q''_i\big),$\\
  & $(Q_m \times Q_m') \times Q_m'',$\\
  & $\big[[X, X'], X'']$\\
  & $G^{(A\|A')\|A''},$\\
  & $\big[[X_m, X'_m], X''_m \big] \Big \rangle$
\end{tabular}
\end{center}

\noindent In order to establish associativity we now have to show
this for each of the elements in the 8-tuple. For the states, the
alphabet, the initial state, the marked states and the variables,
associativity is clear by the laws of set operations. We will now
in turn deal with the guard/action functions and the transition
function.

For the guard function $g^{(A\|A')\|A''} : X^c \rightarrow
\{\mathrm{true}, \mathrm{false}\}$ of the composite automaton we
have by definition

\begin{equation}
  g^{(A\|A')\|A''}(X^c) = \big[g(X) \wedge g'(X') \big] \wedge g''(X'') = g(X) \wedge \big[g'(X') \wedge g''(X'')] = g^{A\|(A'\|A'')}(X^c)
\end{equation}

\noindent Now consider the action function $a^{(A\|A')\|A''} : X^c
\rightarrow X^c$.

klkljkll

\section{Implementation of EFA's with hierarchy in Supremica}

\subsection{Supremica}

\subsection{Implementation}\label{Implementation}
\subsection{Examples}
\end{document}
