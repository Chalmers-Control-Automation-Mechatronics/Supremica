<?xml version="1.0" encoding="iso-8859-1"?>

<project name="Supremica and JGrafChart" default="rebuild" basedir=".">

<property name="src" value="src"/>
<property name="build" value="build"/>
<property name="dist"  value="dist"/>
<property name="doc" value="doc"/>
<property name="examples" value="examples"/>
<property name="templates" value="templates"/>
<property name="images" value="images"/>
<property name="animations" value="animations"/>
<property name="examples" value="examples/includeInJarFile"/>
<property name="help" value="help"/>
<property name="lib" value="lib"/>
<property name="unjared" value="unjared"/>

<property name="xmlrpc_basepackage" value="helma"/>
<property name="xmlrpc_basedir" value="helma"/>

<property name="supremica_basepackage" value="org.supremica"/>
<property name="supremica_basedir" value="org/supremica"/>

<property name="jgrafchart_basepackage" value="org.jgrafchart"/>
<property name="jgrafchart_basedir" value="org/jgrafchart"/>

<property name="project.name" value="Supremica"/>
<property name="backup.dir" value="../backup"/>
<property name="javalibs.dir" value="lib/unjared"/>

<!--
*	If you for some reason prefer javac instead of jikes,
*	just change "jikes" to "classic" on the next line.
-->
<property name="build.compiler" value="jikes"/>

<!-- 
*	Run this script after checking out the sources for the
*	first time. 
*	You should also run everytime one of jar files below
*	has been updated.
*
-->

<target name="initialize" depends="clean">
 	<mkdir dir="${build}"/>
	<delete includeEmptyDirs="true" >
		<fileset dir="${build}" />
	</delete>

 	<mkdir dir="${dist}"/>
	<delete includeEmptyDirs="true" >
		<fileset dir="${dist}" />
	</delete>
	
 	<mkdir dir="${doc}"/>
	<delete includeEmptyDirs="true" >
		<fileset dir="${doc}" />
	</delete>
		 
	<mkdir dir="${lib}/${unjared}"/>
	<delete includeEmptyDirs="true" >
		<fileset dir="${lib}/${unjared}" />
	</delete>
			 
	<unjar src="${lib}/JGo.jar" dest="${lib}/${unjared}"/>	
	<unjar src="${lib}/JGoLayout.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/antlr.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/crimson.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/grappa.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/help.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/jaxp.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/jdom.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/jhall.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/jlfgr-1_0.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/junit.jar" dest="${lib}/${unjared}"/>	
	<unjar src="${lib}/log4j-core.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/log4j.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/regler.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/jel.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/scenebeans.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/natutil.jar" dest="${lib}/${unjared}"/>
	<unjar src="${lib}/scenebeansXmlCompability.jar" dest="${lib}/${unjared}"/>
	
 	<mkdir dir="${lib}/licensed"/>
 	<touch file="${lib}/licensed/JGo.jar"/>	
 	<touch file="${lib}/licensed/JGoLayout.jar"/>	 	
	<unjar src="${lib}/licensed/JGo.jar" dest="${lib}/${unjared}"/>	
	<unjar src="${lib}/licensed/JGoLayout.jar" dest="${lib}/${unjared}"/>
	
	<mkdir dir="${lib}/${unjared}/META-INF"/>
	<delete includeEmptyDirs="true">
		<fileset dir="${lib}/${unjared}/META-INF"/>
	</delete>	

</target>

<target name="init">
	<tstamp/>
</target>

<target name="clean">
	<mkdir dir="${build}"/>
	<delete dir="${build}" includeEmptyDirs="true"/>
	<mkdir dir="${build}"/>

	<mkdir dir="${dist}"/>	
	<delete>
		<fileset dir="${dist}">
			<patternset id="cleandistfiles">
				<include name="**"/>
			</patternset>
		</fileset>
	</delete>		

	<mkdir dir="${doc}"/>
	<delete dir="${doc}"/>
	<mkdir dir="${doc}"/>
	<mkdir dir="${doc}/api"/>	
</target>

<target name="build_jni">
	<exec executable="javah">
		<arg value="-jni -o ${src}/${supremica_basedir}/sattline/openmms/JOpenMMS.h ${my_packagedir}.sattline.openmms.JOpenMMS"/>
	</exec>
</target>

<target name="backup" depends="init,clean">
	<tar tarfile="${backup.dir}/${project.name}_${DSTAMP}_${TSTAMP}.tar" 
		basedir="../${project.name}"
		excludes="rsync/**,put,get"/>
	<gzip zipfile="${backup.dir}/${project.name}_${DSTAMP}_${TSTAMP}.tar.gz"
		src="${backup.dir}/${project.name}_${DSTAMP}_${TSTAMP}.tar"/>
	<delete file="${backup.dir}/${project.name}_${DSTAMP}_${TSTAMP}.tar"/>
</target>

<target name="version" depends="init">
	<delete quiet="true" file="${src}/${supremica_basedir}/Version.java"/>
	<copy file="${templates}/Version.tmpl" tofile="${src}/${supremica_basedir}/Version.java"/>	
	<replace file="${src}/${supremica_basedir}/Version.java" token="@BUILDDATE" value="${DSTAMP}${TSTAMP}"/>
	<delete quiet="true" file="${dist}/SupremicaVersion.txt"/>
	<copy file="${templates}/SupremicaVersion.txt" tofile="${dist}/SupremicaVersion.txt"/>	
	<replace file="${dist}/SupremicaVersion.txt" token="@BUILDDATE" value="${DSTAMP}${TSTAMP}"/>
</target>

<!-- Compile:
*	Reuses existing class files, but recompiles those
*	source files that have changed.
-->
<target name="compile" depends="compile_supremica,compile_jgrafchart">
	<javac
		srcdir="${src}"
		destdir="${build}"
		classpath="${lib}/${unjared}"
		includeJavaRuntime="yes"
		deprecation="false"
		verbose="false"
		includes="
			${supremica_basedir}/external/**,
			${jgrafchart_basedir}/external/**"	
	/>
</target>

<!-- Compile:
*	Reuses existing class files, but recompiles those
*	source files that have changed.
-->
<target name="compile_supremica">
	<javac
		srcdir="${src}"
		destdir="${build}"
		classpath="${lib}/${unjared}"
		includeJavaRuntime="yes"
		deprecation="false"
		verbose="false"
		excludes="
			${jgrafchart_basedir}/**,
			${supremica_basedir}/external/**,
			${supremica_basedir}/sattline/**,
			${supremica_basedir}/supervisor/**"	
	/>

</target>

<!-- Compile:
*	Reuses existing class files, but recompiles those
*	source files that have changed.
-->
<target name="compile_jgrafchart">
	<javac
		srcdir="${src}"
		destdir="${build}"
		classpath="${lib}/${unjared}"
		includeJavaRuntime="yes"
		deprecation="false"
		verbose="false"
		excludes="${supremica_basedir}/**,
			${jgrafchart_basedir}/external/**,		
			${jgrafchart_basedir}/io/**,
			${xmlrpc_basedir}/**"	
	/>

</target>

<!-- Build:
*	A standard compilation followed by packaging
*	all files into a jar file. 
-->
<target name="build" depends="compile,jar,startfiles_supremica,startfiles_jgrafchart">
</target>

<!-- Rebuild:
*	Deletes all existing class files, recompiles all files,
*	and packages all files into a jar file that can
*	be executed without any other dependencies. 
-->
<target name="rebuild" depends="clean,version,build">
</target>

<!-- Build:
*	A standard compilation followed by packaging
*	all files into a jar file. 
-->
<target name="build_supremica" depends="compile_supremica,jar_supremica,startfiles_supremica">
</target>

<!-- Build:
*	A standard compilation followed by packaging
*	all files into a jar file. 
-->
<target name="build_supremica_student" depends="compile_supremica,jar_supremica_student,startfiles_supremica_student">
</target>

<!-- Build:
*	A standard compilation followed by packaging
*	all files into a jar file. 
-->
<target name="build_supremica_teacher" depends="compile_supremica,jar_supremica_teacher,startfiles_supremica_teacher">
</target>

<!-- Rebuild:
*	Deletes all existing class files, recompiles all files,
*	and packages all files into a jar file that can
*	be executed without any other dependencies. 
-->
<target name="rebuild_supremica" depends="clean,version,build_supremica">
</target>

<!-- Rebuild:
*	Deletes all existing class files, recompiles all files,
*	and packages all files into a jar file that can
*	be executed without any other dependencies. 
-->
<target name="rebuild_supremica_student" depends="clean,version,build_supremica_student">
</target>

<!-- Rebuild:
*	Deletes all existing class files, recompiles all files,
*	and packages all files into a jar file that can
*	be executed without any other dependencies. 
-->
<target name="rebuild_supremica_teacher" depends="clean,version,build_supremica_teacher">
</target>


<!-- Build:
*	A standard compilation followed by packaging
*	all files into a jar file. 
-->
<target name="build_jgrafchart" depends="compile_jgrafchart,jar_jgrafchart,startfiles_jgrafchart">
</target>

<!-- Rebuild:
*	Deletes all existing class files, recompiles all files,
*	and packages all files into a jar file that can
*	be executed without any other dependencies. 
-->
<target name="rebuild_jgrafchart" depends="clean,version,build_jgrafchart">
</target>

<target name="jar_jgrafchart">
	<jar jarfile="${dist}/Supremica.jar" manifest="${templates}/JGRAFCHART_MANIFEST.MF"> 
		<fileset dir="${build}"/>
		<fileset dir="${javalibs.dir}">		
			<patternset>
				<include name="com/nwoods/**"/>
				<include name="se/lth/control/realtime/**"/>
				<exclude name="com/nwoods/layout/**"/>
			</patternset>	
		</fileset>
	</jar>
</target>

<target name="jar_supremica">
	<jar jarfile="${dist}/Supremica.jar" manifest="${templates}/SUPREMICA_MANIFEST.MF"> 
		<fileset dir="${build}">
			<patternset>
				<include name="**/*"/>
				<exclude name="org/supremica/apps/SupremicaTeacher.class"/>
			</patternset>			
		</fileset>
		<fileset dir="${images}"/>
		<fileset dir="${examples}"/>
		<fileset dir="${animations}"/>		
		<fileset dir="${javalibs.dir}"/>		
	</jar>
</target>

<target name="jar_supremica_student">
	<jar jarfile="${dist}/Supremica.jar" manifest="${templates}/SUPREMICA_MANIFEST.MF"> 
		<fileset dir="${build}">
			<patternset>
				<include name="**/*"/>
				<exclude name="org/supremica/apps/Supremica.class"/>
				<exclude name="org/supremica/apps/SupremicaApplet.class"/>
				<exclude name="org/supremica/apps/SupremicaTeacher.class"/>
				<exclude name="org/supremica/apps/SupremicaClient.class"/>
				<exclude name="org/supremica/apps/SupremicaServer.class"/>
			</patternset>			
		</fileset>
		<fileset dir="${images}"/>
		<fileset dir="${examples}"/>
		<fileset dir="${animations}"/>			
		<fileset dir="${javalibs.dir}"/>		
	</jar>
</target>

<target name="jar_supremica_teacher">
	<jar jarfile="${dist}/Supremica.jar" manifest="${templates}/SUPREMICA_MANIFEST.MF"> 
		<fileset dir="${build}"/>
		<fileset dir="${images}"/>
		<fileset dir="${examples}"/>
		<fileset dir="${animations}"/>			
		<fileset dir="${javalibs.dir}"/>		
	</jar>
</target>

<target name="jar">
	<jar jarfile="${dist}/Supremica.jar" manifest="${templates}/ALL_MANIFEST.MF"> 
		<fileset dir="${build}"/>
		<fileset dir="${images}"/>
		<fileset dir="${examples}"/>
		<fileset dir="${animations}"/>			
		<fileset dir="${javalibs.dir}"/>	
	</jar>
</target>

<target name="startfiles_supremica" depends="startfiles_supremica_student,startfiles_supremica_teacher">
	<copy file="${templates}/Supremica" todir="${dist}"/>	
	<chmod file="${dist}/Supremica" perm="755"/>	
	<copy file="${templates}/Supremica.cmd" todir="${dist}"/>	
	<chmod file="${dist}/Supremica.cmd" perm="644"/>
	<copy file="${templates}/SupremicaApplet.html" todir="${dist}"/>	
	<chmod file="${dist}/SupremicaApplet.html" perm="644"/>	
	<copy file="${templates}/SupremicaAppletViewer.html" todir="${dist}"/>	
	<chmod file="${dist}/SupremicaAppletViewer.html" perm="644"/>	
</target>

<target name="startfiles_supremica_student">
	<copy file="${templates}/SupremicaStudent" todir="${dist}"/>	
	<chmod file="${dist}/SupremicaStudent" perm="755"/>	
	<copy file="${templates}/SupremicaStudent.cmd" todir="${dist}"/>	
	<chmod file="${dist}/SupremicaStudent.cmd" perm="644"/>
</target>

<target name="startfiles_supremica_teacher">
	<copy file="${templates}/SupremicaTeacher" todir="${dist}"/>	
	<chmod file="${dist}/SupremicaTeacher" perm="755"/>	
	<copy file="${templates}/SupremicaTeacher.cmd" todir="${dist}"/>	
	<chmod file="${dist}/SupremicaTeacher.cmd" perm="644"/>
</target>

<target name="startfiles_jgrafchart">
	<copy file="${templates}/JGrafChart" todir="${dist}"/>	
	<chmod file="${dist}/JGrafChart" perm="755"/>	
	<copy file="${templates}/JGrafChart.cmd" todir="${dist}"/>	
	<chmod file="${dist}/JGrafChart.cmd" perm="644"/>
</target>

<target name="doc" depends="doc_supremica,doc_jgrafchart">
</target>


<target name="doc_supremica">
	<javadoc
		sourcepath="${src}"
		destdir="${doc}/api"
		packagenames="${supremica_basepackage}.automata.*,${supremica_basepackage}.gui.*,${supremica_basepackage}.util.*,${supremica_basepackage}.apps.*"
		classpath="${lib}/${unjared}"
		author="true"
		version="true"
		use="true"
		private="true"
		windowtitle="Supremica API"
		overview="${templates}/Overview.html"
		doctitle="Supremica"
		
		bottom="Copyright &#169; 2001 Supremica and Knut Akesson. All Rights Reserved.">
	</javadoc>
</target>

<target name="doc_jgrafchart">
	<javadoc
		sourcepath="${src}"
		destdir="${doc}/api"
		packagenames="${jgrafchart_basepackage}.*"
		classpath="${lib}/${unjared}"
		author="true"
		version="true"
		use="true"
		private="true"
		windowtitle="JGrafChart API"
		doctitle="JGrafChart"
		
		bottom="Copyright &#169; 2001 Karl-Erik Arzen. All Rights Reserved.">
	</javadoc>
</target>

<target name="run">
	<java classname="${supremica_basepackage}.apps.Supremica" fork="yes">
		<classpath>
			<pathelement location="${dist}/Supremica.jar" />
			<pathelement path="${java.class.path}" />
		</classpath>		 
	</java>
</target>


<target name="deploy" depends="deployNT,deploy9X">
</target>

<target name="deployNT">
	<copy file="${dist}/Supremica.jar" todir="H:\public_html\Supremica\updates\noarch"/>	
	<copy file="${dist}/SupremicaVersion.txt" todir="H:\public_html\Supremica\updates\noarch"/>
	<copy file="${dist}/Supremica.jar" todir="U:\temp\SupremicaInstaller\SupremicaDist\Runtime\NoArch"/>	
	<copy file="${dist}/SupremicaVersion.txt" todir="U:\temp\SupremicaInstaller\SupremicaDist\Runtime\NoArch"/>	
	<exec executable="C:\Progra~1\INNOSE~1\iscc.exe">
		<arg value="U:\temp\SupremicaInstaller\SupremicaDist.iss"/>
	</exec>
	<copy file="U:\temp\SupremicaInstaller\Output\setup.exe" todir="H:\public_html\Supremica\distributions\windows"/>	
</target>

<target name="deploy9X">
	<copy file="${dist}/Supremica.jar" todir="U:\temp\SupremicaInstallerX\SupremicaDist\Runtime\NoArch"/>	
	<copy file="${dist}/SupremicaVersion.txt" todir="U:\temp\SupremicaInstallerX\SupremicaDist\Runtime\NoArch"/>
	<exec executable="C:\Progra~1\INNOSE~1\iscc.exe">
		<arg value="U:\temp\SupremicaInstallerX\SupremicaDist.iss"/>
	</exec>
	<copy file="U:\temp\SupremicaInstallerX\Output\setup.exe" todir="H:\public_html\Supremica\distributions\windows9x"/>	
</target>

</project>
       
