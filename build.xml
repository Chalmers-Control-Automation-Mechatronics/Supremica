<?xml version="1.0" encoding="iso-8859-1"?>

<project name="Supremica" default="build" basedir=".">
    
    <property name="arch.properties" location="arch.properties"/>

    <property file="build.properties"/>
    <property file="${arch.properties}"/>

    <property name="src" value="src"/>
    <property name="testssrc" value="tests/src"/>
    <property name="runtimesoftplcsrc" value="runtime/softplc/src"/>
    <property name="build" value="build"/>
    <property name="platform" value="platform"/>
    <property name="testsbuild" value="tests/build"/>
    <property name="runtimesoftplcbuild" value="runtime/softplc/build"/>
    <property name="dist"  value="dist"/>
    <property name="doc" value="doc"/>
    <property name="examples" value="examples"/>
    <property name="templates" value="templates"/>
    <property name="images" value="images"/>
    <property name="animations" value="animations"/>
    <property name="userinterfaces" value="userinterfaces"/>
    <property name="help" value="help"/>
    <property name="lib" value="lib"/>
    <property name="unjared" value="unjared"/>
    
    <property name="xmlrpc_basepackage" value="helma"/>
    <property name="xmlrpc_basedir" value="helma"/>
    
    <property name="resources" value="resources"/>
    
    <property name="supremica_basepackage" value="org.supremica"/>
    <property name="supremica_basedir" value="org/supremica"/>
    
    <!--property name="jgrafchart_basepackage" value="org.jgrafchart"/>
    <property name="jgrafchart_basedir" value="org/jgrafchart"/-->
    
    <property name="project.name" value="Supremica"/>
    <property name="backup.dir" value="../backup"/>
    <property name="installer.dir" value="C:\Supremica Installer"/>
    <property name="javalibs.dir" value="lib/unjared"/>
    
    <property name="logs" location="logs"/>
    <property name="logs.reports" location="${logs}/reports"/>
    <property name="logs.results" location="${logs}/results"/>
    
    
    <!-- Waters -->
    <property name="waters.dir" location="waters"/>
    <property name="waters.examples" location="${examples}/waters"/>
    <property name="waters.xml" location="${waters.dir}/xml"/>
    <property name="waters.xsd" location="${waters.xml}/xsd"/>
    <property name="waters.xsl" location="${waters.xml}/xsl"/>
    <property name="waters.jaxbjar"
              location="${waters.dir}/java/jar/waters_jaxb.jar"/>
    <property name="waters.jniglue.jar"
              location="${waters.dir}/java/jar/jniglue.jar"/>

    <!-- JAXB -->
    <property name="activation.jar" location="${lib}/activation.jar"/>
    <property name="jaxb-api.jar" location="${lib}/jaxb-api.jar"/>
    <property name="jaxb-impl.jar" location="${lib}/jaxb-impl.jar"/>
    <property name="jaxb1-impl.jar" location="${lib}/jaxb1-impl.jar"/>
    <property name="jsr173_api.jar" location="${lib}/jsr173_1.0_api.jar"/>
    
    <path id="jaxb.classpath">
        <pathelement location="${activation.jar}"/>
        <pathelement location="${jaxb-api.jar}"/>
        <pathelement location="${jaxb-impl.jar}"/>
        <pathelement location="${jaxb1-impl.jar}"/>
        <pathelement location="${jsr173_api.jar}"/>
    </path>

    <!-- Build Instructions -->
    <path id="supremica.classpath">
        <pathelement location="${dist}/SupremicaLib.jar"/>
    </path>
    
    <patternset id="all_nested_classfiles.patternset">
        <include name="**/*.class"/>
    </patternset>

    <taskdef resource="net/sf/antcontrib/antlib.xml">
        <classpath>
            <pathelement location="${lib}/ant-contrib-1.0b3.jar"/>
        </classpath>
    </taskdef>
    
    <!-- test if abtlib works -->
    <!--<target name="test-ant-contrib"> 
    
        <echo message="Testing ant-contrib is working by looping through a list of letters."/>
        <for list="a,b,c,d,e" param="letter">
            <sequential>
                <echo>Letter @{letter}</echo>
            </sequential>
        </for>

    </target>-->
    <!-- 
*       Build this target after checking out the sources for the
*       first time. 
*       You should also run it every time one of the jar files below
*       has been updated.
    -->
    <target
        name="initialize"
        depends="clean,jar_supremica_lib,build,-jar_supremica_tests,cpp_waters"
        description="Rebuilds the project from scratch."/>

    <target name="initialize_jars" depends="-jar_waters_jaxb">  
        <!-- PLEASE ADD COMMENTS DESCRIBING THE DIFFERENT LIBRARIES. -->

        <!-- Library for handling db in SOC -->
        <unjar src="${lib}/sqljdbc.jar" dest="${lib}/${unjared}"/>
        <!-- Library used by SOC -->
        <unjar src="${lib}/jniwrap-3.1.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/jexcel-1.0.jar" dest="${lib}/${unjared}"/>

        <!-- Create multisplit pane without nesting -->
        <unjar src="${lib}/multisplit.jar" dest="${lib}/${unjared}"/>

        <unjar src="${lib}/JGo.jar" dest="${lib}/${unjared}"/>  
        <unjar src="${lib}/JGoLayout.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/grappa.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/help.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/jdom.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/jhall.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/jlfgr-1_0.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/log4j.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/regler.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/scenebeans.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/natutil.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/scenebeansXmlCompability.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/BCEL.jar" dest="${lib}/${unjared}"/>
    	<!-- JacoZoom -->
        <unjar src="${lib}/ctrlmngr.jar" dest="${lib}/${unjared}"/>     
        <unjar src="${lib}/CCOM.jar" dest="${lib}/${unjared}"/> 
        <unjar src="${lib}/jacorb.jar" dest="${lib}/${unjared}"/>       
        <unjar src="${lib}/jutils.jar" dest="${lib}/${unjared}"/>       
        <!-- <unjar src="${lib}/xalan.jar" dest="${lib}/${unjared}"/>-->
        <unjar src="${lib}/xmlBlaster.jar" dest="${lib}/${unjared}"/>   
        <unjar src="${lib}/xtdash.jar" dest="${lib}/${unjared}"/>       
        <unjar src="${lib}/jgrafchart.jar" dest="${lib}/${unjared}"/>   
        <unjar src="${lib}/sysutils.jar" dest="${lib}/${unjared}"/>     
        <!-- Libraries for IEC61499 Fuber runtime support in Supremica. -->
        <!--   Maintained by: cengic@chalmers.se -->
        <!-- <unjar src="${lib}/fcc_demo.jar" dest="${lib}/${unjared}"/> -->
        <!-- <unjar src="${lib}/fuber.jar" dest="${lib}/${unjared}"/> -->
        <!-- End IEC61499 runtime libraries -->
        <unjar src="${lib}/swixml.jar" dest="${lib}/${unjared}"/>
        <!-- GNU Trove -->
        <unjar src="${lib}/trove-3.0.3.jar" dest="${lib}/${unjared}"/>
        <!-- Library for handling BDDs. -->
        <unjar src="${lib}/javabdd-2.0.jar" dest="${lib}/${unjared}"/>
        <unjar src="${waters.jaxbjar}" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/manufacturingTables_jaxb.jar"
               dest="${lib}/${unjared}"/>
        <unjar src="${lib}/genericPLCProgramDescription_jaxb.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/itext.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/fsa2sat-1.0.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/javailp-1.2.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/lpsolve55j.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/cplex.jar" dest="${lib}/${unjared}"/>
        
        <!-- Library for handling Sat4j. -->
        <unjar src="${lib}/org.sat4j.core.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/org.sat4j.csp.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/org.sat4j.csp.xmlparser.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/org.sat4j.pb.jar" dest="${lib}/${unjared}"/>
        <unjar src="${lib}/js.jar" dest="${lib}/${unjared}"/>
        
        <!-- Tools for Adobe PostScript. -->
        <unjar src="${lib}/xmlgraphics-commons-1.4.jar"
               dest="${lib}/${unjared}"/>

        <unjar src="${lib}/jgrafchartresources.jar" dest="${resources}"/>

        <!-- Ant 1.6.0 is not able to unjar empty jar files -->
        <!--
        <mkdir dir="${lib}/licensed"/>
        <touch file="${lib}/licensed/JGo.jar"/> 
        <touch file="${lib}/licensed/JGoLayout.jar"/>
        <unjar src="${lib}/licensed/JGo.jar" dest="${lib}/${unjared}"/> 
        <unjar src="${lib}/licensed/JGoLayout.jar" dest="${lib}/${unjared}"/>
        -->
        <!-- JAXB -->
        <unjar src="${activation.jar}" dest="${lib}/${unjared}"/>       
        <unjar src="${jaxb-api.jar}" dest="${lib}/${unjared}"/>
        <unjar src="${jaxb-impl.jar}" dest="${lib}/${unjared}"/>
        <unjar src="${jaxb1-impl.jar}" dest="${lib}/${unjared}"/>
        <unjar src="${jsr173_api.jar}" dest="${lib}/${unjared}"/>   
        <!-- JUnit -->
        <unjar src="${lib}/junit.jar" dest="${lib}/${unjared}"/>
    </target>
    
    <target name="clean_build">
        <delete dir="${build}"/>
        <mkdir dir="${build}"/>
        <delete dir="${testsbuild}"/>
        <mkdir dir="${testsbuild}"/>
    </target>
    
    <target name="clean" depends="clean_build">
        <delete file="${arch.properties}"/>
        <delete dir="${dist}"/>
        <mkdir dir="${dist}"/>
        <delete dir="${src}/org/w3"/>
        <mkdir dir="${src}/org/w3"/>        
        <delete dir="${doc}/api"/>
        <mkdir dir="${doc}/api"/>               
        <delete dir="${lib}/${unjared}"/>
        <mkdir dir="${lib}/${unjared}"/>        
        <delete dir="${resources}"/>
        <mkdir dir="${resources}"/>
        <delete dir="${lib}/${unjared}/META-INF"/>
        <mkdir dir="${lib}/${unjared}/META-INF"/>
        <delete dir="${src}/net/sourceforge/waters/external/promela/parser"/>
        <ant dir="${waters.dir}" target="clean" inheritAll="false"/>
    </target>
    
    <target name="build_jni">
        <exec executable="javah">
            <arg value="-jni -o ${src}/${supremica_basedir}/sattline/openmms/JOpenMMS.h ${my_packagedir}.sattline.openmms.JOpenMMS"/>
        </exec>
    </target>

    <target name="-init">
        <tstamp/>
        <tstamp>
            <format property="build.time"
                    pattern="YYYY-MM-dd HH:mm:ss z"
                    timezone="GMT"/>
        </tstamp>
    </target>
            
    <target name="backup" depends="-init,clean">
        <tar tarfile="${backup.dir}/${project.name}_${DSTAMP}_${TSTAMP}.tar" 
             basedir="../${project.name}"
             excludes="rsync/**,put,get,lib/unjared/**"/>
        <gzip zipfile="${backup.dir}/${project.name}_${DSTAMP}_${TSTAMP}.tar.gz"
              src="${backup.dir}/${project.name}_${DSTAMP}_${TSTAMP}.tar"/>
        <delete file="${backup.dir}/${project.name}_${DSTAMP}_${TSTAMP}.tar"/>
    </target>
    
    <target name="backup_src" depends="-init,clean">
        <tar tarfile="${backup.dir}/${project.name}_onlysrc_${DSTAMP}_${TSTAMP}.tar" 
             basedir="../${project.name}/src"
             excludes="rsync/**,put,get"/>
        <gzip zipfile="${backup.dir}/${project.name}_onlysrc_${DSTAnet/sourceforge/waters/configMP}_${TSTAMP}.tar.gz"
              src="${backup.dir}/${project.name}_onlysrc_${DSTAMP}_${TSTAMP}.tar"/>
        <delete file="${backup.dir}/${project.name}_onlysrc_${DSTAMP}_${TSTAMP}.tar"/>
    </target>
    
    <target name="version" depends="-init,detect_arch">
        <delete quiet="true" file="${src}/${supremica_basedir}/Version.java"/>
        <property name="version.dir" value="net/sourceforge/waters/config"/>
        <property name="version.file"
                  location="${build}/${version.dir}/Version.properties"/>
        <copy file="${templates}/Version.properties"
              tofile="${version.file}" overwrite="true"/>
        <replace file="${version.file}">
            <replacefilter token="@TIME" value="${build.time}"/>
            <replacefilter token="@ARCH" value="${native.host.arch}"/>
        </replace>
        <copy todir="${build}/${version.dir}">
            <fileset dir="${src}/${version.dir}" includes="*.html"/>
        </copy>
    </target>
    
    <target name="compile" depends="compile_manufacturingTables_jaxb,compile_supremica,compile_supremica_tests"/>
    
    <target name="compile_supremica" depends="-startfiles_local_supremica">
        <javac debug="on"
               debuglevel="lines,source,vars"
               srcdir="${src}"
               destdir="${build}"
               verbose="false"
               nowarn="true"
	       source="1.7"
	       encoding="ISO-8859-15"
               fork="true"
               includeantruntime="false"
               memoryMaximumSize="512M">
            <classpath>    
                <pathelement location="${lib}/${unjared}"/>
            </classpath>
        </javac>
    </target>
    
    <target name="compile_manufacturingTables_jaxb" depends="build_rop_processeditor">
        <javac
            srcdir="${src}"
            destdir="${build}"
            classpath="${lib}/${unjared}"
            includeJavaRuntime="yes"
            deprecation="false"
            verbose="false"
            nowarn="true"
            includes="${supremica_basedir}/manufacturingTables/xsd/**"          
            source="1.7"
            encoding="ISO-8859-15"
            includeantruntime="false"
        />
    </target>

    <target name="compile_genericPLCProgramDescription_jaxb">
        <javac
            srcdir="${src}"
            destdir="${build}"
            classpath="${lib}/${unjared}"
            includeJavaRuntime="yes"
            deprecation="false"
            verbose="false"
            nowarn="true"
            includes="${supremica_basedir}/external/genericPLCProgramDescription/xsd/**"                
            source="1.7"
            encoding="ISO-8859-15"
            includeantruntime="false"
        />
    </target>

    
    <!-- Compile:
*       Reuses existing class files, but recompiles those
*       source files that have changed.
    -->
    <target name="compile_scheduling">
        <javac
            debug="on"
            debuglevel="lines,source,vars"
            srcdir="${src}"
            destdir="${build}"
            classpath="${lib}/${unjared}"
            includeJavaRuntime="yes"
            deprecation="false"
            verbose="false"
            nowarn="true"
            includes="${supremica_basedir}/automata/algorithms/scheduling/**"           
            source="1.7"
            encoding="ISO-8859-15"
            includeantruntime="false"
        />
    </target>
    
    <!-- Compile Supremica Tests
*       Reuses existing class files, but recompiles those
*       source files that have changed.
    -->
    <target name="compile_supremica_tests">
        <javac debug="on"
               debuglevel="lines,source"
               srcdir="${testssrc}"
               destdir="${testsbuild}"
               includeJavaRuntime="yes"
               deprecation="false"
               verbose="false"
               includeantruntime="false"
               encoding="ISO-8859-15"
        >
            <classpath> 
                <pathelement location="${build}"/>
                <pathelement path="${lib}/${unjared}"/>
            </classpath>
        </javac>
    </target>
    
    <!-- Compile:
*       Reuses existing class files, but recompiles those
*       source files that have changed.
    -->
    <!-- 
<target name="compile_jgrafchart">
        <javac
                debug="on"
                debuglevel="source"
                srcdir="${src}"
                destdir="${build}"
                classpath="${lib}/${unjared}"
                includeJavaRuntime="yes"
                deprecation="false"
                verbose="false"
                includeantruntime="false"
                excludes="${supremica_basedir}/**,
                        ${jgrafchart_basedir}/external/**,              
                        ${jgrafchart_basedir}/io/**,
                        ${xmlrpc_basedir}/**"   
        />

</target>
-->
    
    <!-- Compile Runtime
*       Reuses existing class files, but recompiles those
*       source files that have changed.
    -->
    <target name="compile_runtime_softplc">
        <javac
            srcdir="${runtimesoftplcsrc}"
            destdir="${runtimesoftplcbuild}"
            includeJavaRuntime="yes"
            deprecation="false"
            verbose="false"
            encoding="ISO-8859-15"
            includeantruntime="false">
        </javac>
        
    </target>
        
    <target name="build" depends="compile,-jar_supremica,-startfiles_supremica" description=
            "Recompiles only the files that have changed, then packages all files into a jar file.">
    </target>
    
    <target name="rebuild" depends="clean_build,build" description=
            "Deletes all existing class files, recompiles all files, and packages all files into a jar file that can be executed without any other dependencies.">
    </target>
    
    <target name="jar_supremica_lib" depends="initialize_jars">
        <delete dir="${javalibs.dir}/META-INF"/>
        <jar jarfile="${dist}/SupremicaLib.jar"> 
            <fileset dir="${javalibs.dir}"/>
        </jar>
    </target>
    
    <target name="downloads_supremica">
        <pathconvert refid="supremica.classpath"
                     pathsep=" " property="manifest.pathlist">
            <mapper type="flatten"/>
        </pathconvert>
        <echo file="${build}/manifest.txt">Manifest-Version: 1.0
Created-By: Knut Akesson
Main-Class: org.supremica.gui.ide.IDE
Class-Path: ${manifest.pathlist}</echo>
    </target>
    
    <target name="copy_watersxmlfiles_into_build">
        <copy file="${waters.xsl}/vw.xsl"
              todir="${build}/net/sourceforge/waters/external/valid"/>
        <copy todir="${build}/net/sourceforge/waters/model/marshaller">
            <fileset dir="${waters.xsd}" includes="*.xsd"/>
        </copy>
        <copy todir="${build}/net/sourceforge/waters/samples/maze">
            <fileset dir="${waters.examples}/maze" includes="*.wmod"/>
        </copy>
    </target>
    
    <target name="-jar_supremica"
            depends="compile_supremica,downloads_supremica,copy_watersxmlfiles_into_build,version">
        <jar jarfile="${dist}/Supremica.jar" manifest="${build}/manifest.txt"> 
            <fileset dir="${build}"
                     excludes="net/sourceforge/waters/analysis/comp552/"/>
            <fileset dir="${images}"/>
            <fileset dir="${examples}" includes="includeInJarFile/"/>
            <fileset dir="${animations}"/>
            <fileset dir="${userinterfaces}"/>  
            <fileset dir="${runtimesoftplcbuild}"/>
        </jar>
    </target>
    
    <target name="-jar_supremica_tests" depends="compile_supremica_tests">
        <jar jarfile="${dist}/SupremicaTest.jar">
            <fileset dir="${testsbuild}"/>
            <zipfileset dir="${waters.examples}"
                        prefix="net/sourceforge/waters/model/marshaller/examples"/>
        </jar>
    </target>
    
    <target name="-jar_waters_jaxb">
        <ant dir="${waters.dir}" target="jaxb-jar" inheritAll="false"/>
    </target>
    
    <target name="build_rop_processeditor" description="builds rop processeditor">
        <ant dir="schema/" target="gen_manufacturingtables_rop_processeditor" inheritAll="false"/>
        <ant dir="schema/" target="gen_manufacturingtables_il" inheritAll="false"/>
        <ant dir="schema/" target="gen_manufacturingtables_pr" inheritAll="false"/>
        <ant dir="schema/" target="gen_manufacturingtables_vr" inheritAll="false"/>
        <ant dir="schema/" target="gen_manufacturingtables_eop" inheritAll="false"/>
    </target>

    <target name="detect_arch"
            description="Forces call to ArchitectureDetector to recreate arch.properties file.">
        <ant dir="${waters.dir}" target="jniglue-jar" inheritAll="false"/>
        <java classname="net.sourceforge.waters.build.arch.ArchitectureDetector"
              fork="true" failonerror="true">
          <classpath>
              <pathelement location="${waters.jniglue.jar}"/>
          </classpath>
          <arg file="${platform}"/>
          <arg file="${arch.properties}"/>
        </java>
        <property file="${arch.properties}"/>
    </target>

    <target name="-detect_arch" depends="detect_arch"
            unless="native.host.arch"/>

    <target name="-dynamic_libs" depends="-detect_arch">
        <copy todir="${dist}" failonerror="false">
            <fileset dir="${platform}/${native.host.arch}/lib" includes="*"/>
        </copy>
    </target>


    <target name="-cpp_waters_compile" depends="-detect_arch">
        <ant dir="${waters.dir}" target="cpp" inheritAll="false">
            <property name="native.host.arch" value="${native.host.arch}"/>
        </ant>
    </target>

    <target name="-cpp_waters_check">
        <available file="${waters.dir}/cpp/lib/${native.host.arch}.debug"
                   type="dir"
                   property="native.compiled"/>
    </target>

    <target name="-cpp_waters_copy"
            depends="-cpp_waters_compile,-cpp_waters_check"
            if="native.compiled">
        <copy todir="${dist}" failonerror="false">
            <fileset dir="${waters.dir}/cpp/lib/${native.host.arch}.debug"
                     includes="*"/>
        </copy>
    </target>

    <target name="cpp_waters" depends="-cpp_waters_compile,-cpp_waters_copy"
           description="Builds debug version of Waters dynamic link library."/>

    <target name="ccpp_waters" depends="-detect_arch"
            description="Builds Waters dynamic libraries for multiple platforms.">
      <ant dir="${waters.dir}" target="cpp" inheritAll="false">
        <property name="native.host.arch" value="${native.host.arch}"/>
        <property name="native.target.arch" value="win32.x86"/>
        <property name="make.release" value="1"/>
      </ant>
      <copy todir="${platform}/win32.x86/lib" failonerror="false">
        <fileset dir="${waters.dir}/cpp/lib/win32.x86" includes="*"/>
      </copy>
      <ant dir="${waters.dir}" target="cpp" inheritAll="false">
        <property name="native.host.arch" value="${native.host.arch}"/>
        <property name="native.target.arch" value="win32.amd64"/>
        <property name="make.release" value="1"/>
      </ant>
      <copy todir="${platform}/win32.amd64/lib" failonerror="false">
        <fileset dir="${waters.dir}/cpp/lib/win32.amd64" includes="*"/>
      </copy>
      <ant dir="${waters.dir}" target="cpp" inheritAll="false">
        <property name="native.host.arch" value="${native.host.arch}"/>
        <property name="native.target.arch" value="linux.x86"/>
        <property name="make.release" value="1"/>
      </ant>
      <copy todir="${platform}/linux.x86/lib" failonerror="false">
        <fileset dir="${waters.dir}/cpp/lib/linux.x86" includes="*"/>
      </copy>
      <ant dir="${waters.dir}" target="cpp" inheritAll="false">
        <property name="native.host.arch" value="${native.host.arch}"/>
        <property name="native.target.arch" value="linux.amd64"/>
        <property name="make.release" value="1"/>
      </ant>
      <copy todir="${platform}/linux.amd64/lib" failonerror="false">
        <fileset dir="${waters.dir}/cpp/lib/linux.amd64" includes="*"/>
      </copy>
    </target>

    <target name="-jar_manufacturingTables_jaxb" depends="compile_manufacturingTables_jaxb">
        <jar jarfile="${lib}/manufacturingTables_jaxb.jar"> 
            <fileset dir="${build}/">
                <include name="org/supremica/manufacturingTables/xsd/**"/>
            </fileset>
        </jar>
        <delete>
            <fileset dir="${lib}">
                <include name="org/supremica/manufacturingTables/xsd/**"/>
            </fileset>
        </delete>
        <unjar src="${lib}/manufacturingTables_jaxb.jar" dest="${lib}/${unjared}"/>
    </target>

    <target name="jar_genericPLCProgramDescription_jaxb" depends="compile_genericPLCProgramDescription_jaxb">
        <jar jarfile="${lib}/genericPLCProgramDescription_jaxb.jar"> 
            <fileset dir="${build}/">
                <include name="org/supremica/external/genericPLCProgramDescription/xsd/**"/>
            </fileset>
        </jar>
        <delete>
            <fileset dir="${lib}">
                <include name="org/supremica/external/genericPLCProgramDescription/xsd/**"/>
            </fileset>
        </delete>
        <unjar src="${lib}/genericPLCProgramDescription_jaxb.jar" dest="${lib}/${unjared}"/>
    </target>

    
    <target name="-startfiles_local_supremica">
        <!--
        <copy file="${templates}/SupremicaJGrafchartLocal" todir="${dist}"/>
        <chmod file="${dist}/SupremicaJGrafchartLocal" perm="644"/>
        <copy file="${templates}/SupremicaJGrafchartLocal.cmd" todir="${dist}"/>
        <chmod file="${dist}/SupremicaJGrafchartLocal.cmd" perm="644"/>
-->

        <copy file="${templates}/verifyRACLocal.cmd" todir="${dist}"/>
        <chmod file="${dist}/verifyRACLocal.cmd" perm="644"/>
        <copy file="${templates}/verifyRAC.cmd" todir="${dist}"/>
        <chmod file="${dist}/verifyRAC.cmd" perm="644"/>
        <copy file="${templates}/loadGenericPLCProgramDescriptionLocal.cmd" todir="${dist}"/>
        <chmod file="${dist}/loadGenericPLCProgramDescriptionLocal.cmd" perm="644"/>
        <copy file="${templates}/loadGenericPLCProgramDescription.cmd" todir="${dist}"/>
        <chmod file="${dist}/loadGenericPLCProgramDescription.cmd" perm="644"/>
        <!--
        <copy file="${templates}/manufacturingTablesTestLocal" todir="${dist}"/>
        <chmod file="${dist}/manufacturingTablesTestLocal" perm="644"/>
        <copy file="${templates}/manufacturingTablesTestLocal.cmd" todir="${dist}"/>
        <chmod file="${dist}/manufacturingTablesTestLocal.cmd" perm="644"/>
        <copy file="${templates}/IDELocal.cmd" todir="${dist}"/>
        <chmod file="${dist}/IDELocal.cmd" perm="644"/>
        <copy file="${templates}/IDELocal" todir="${dist}"/>    
        <chmod file="${dist}/IDELocal" perm="755"/>
        <copy file="${templates}/SupremicaLocal.cmd" todir="${dist}"/>
        <chmod file="${dist}/SupremicaLocal.cmd" perm="644"/>
        <copy file="${templates}/SupremicaLocalMoreMem.cmd" todir="${dist}"/>
        <chmod file="${dist}/SupremicaLocalMoreMem.cmd" perm="644"/>
        <copy file="${templates}/SupremicaLocal" todir="${dist}"/>      
        <chmod file="${dist}/SupremicaLocal" perm="755"/>
        -->
        <copy file="${templates}/SFCtoSMV.cmd" todir="${dist}"/>        
        <chmod file="${dist}/SFCtoSMV.cmd" perm="644"/>
        <!--
        <copy file="${templates}/SupremicaBDD.cmd" todir="${dist}"/>    
        <chmod file="${dist}/SupremicaBDD.cmd" perm="644"/>
-->
        <copy file="${templates}/RelationExtraction.cmd" todir="${dist}"/>
        <chmod file="${dist}/RelationExtraction.cmd" perm="644"/>
        <copy file="${templates}/waters.bat" todir="${dist}"/>
        <chmod file="${dist}/waters.bat" perm="644"/>
        <copy file="${templates}/waters.vbs" todir="${dist}"/>
    </target>

    <target name="-startfiles_supremica"
            depends="-startfiles_local_supremica,-dynamic_libs">
        <copy file="${templates}/StepToPPN.cmd" todir="${dist}"/>
        <chmod file="${dist}/StepToPPN.cmd" perm="644"/>
        <copy file="${templates}/IDE.cmd" todir="${dist}"/>     
        <chmod file="${dist}/IDE.cmd" perm="644"/>
        <copy file="${templates}/IDE" todir="${dist}"/> 
        <chmod file="${dist}/IDE" perm="755"/>
        <copy file="${templates}/susyna2waters" todir="${dist}"/>
        <chmod file="${dist}/susyna2waters" perm="755"/>
        <copy file="${templates}/vw" todir="${dist}"/>
        <chmod file="${dist}/vw" perm="755"/>
        <copy file="${templates}/wcheck" todir="${dist}"/>
        <chmod file="${dist}/wcheck" perm="755"/>
        <copy file="${templates}/uefa" todir="${dist}"/>
        <chmod file="${dist}/uefa" perm="755"/>
        <copy file="${templates}/demo" todir="${dist}"/>
        <chmod file="${dist}/demo" perm="755"/>
        <copy file="${templates}/demo.cmd" todir="${dist}"/>
        <chmod file="${dist}/demo.cmd" perm="644"/>
        <copy file="${templates}/demo_d" todir="${dist}"/>
        <chmod file="${dist}/demo_d" perm="755"/>
        <copy file="${templates}/demo_d.cmd" todir="${dist}"/>
        <chmod file="${dist}/demo_d.cmd" perm="644"/>
        <!--
        <copy file="${templates}/manufacturingTablesTest" todir="${dist}"/>
        <chmod file="${dist}/manufacturingTablesTest" perm="755"/>
        <copy file="${templates}/manufacturingTablesTest.cmd" todir="${dist}"/>
        <chmod file="${dist}/manufacturingTablesTest.cmd" perm="755"/>
        <copy file="${templates}/SupremicaProfiling.cmd" todir="${dist}"/>
        <chmod file="${dist}/SupremicaProfiling.cmd" perm="644"/>
        <copy file="${templates}/SupremicaProfiling" todir="${dist}"/>  
        <chmod file="${dist}/SupremicaProfiling" perm="755"/>
        <copy file="${templates}/SupremicaStandard.cmd" todir="${dist}"/>
        <chmod file="${dist}/SupremicaStandard.cmd" perm="644"/>
        <copy file="${templates}/SupremicaApplet.html" todir="${dist}"/>
        <chmod file="${dist}/SupremicaApplet.html" perm="644"/> 
        <copy file="${templates}/SupremicaAppletViewer.html" todir="${dist}"/>
        <chmod file="${dist}/SupremicaAppletViewer.html" perm="644"/>
        -->
    </target>

    <!--
<target name="-startfiles_jgrafchart">
        <copy file="${templates}/JGrafChart" todir="${dist}"/>  
        <chmod file="${dist}/JGrafChart" perm="755"/>   
        <copy file="${templates}/JGrafChart.cmd" todir="${dist}"/>      
        <chmod file="${dist}/JGrafChart.cmd" perm="644"/>
</target>
-->
   
    <target name="-run_tests" depends="-jar_supremica,-jar_supremica_tests">
        <mkdir dir="${logs.results}"/>
        <delete>
            <fileset dir="${logs.results}" includes="**/log4j.log"/>
        </delete>
        <junit printsummary="on" fork="true" maxmemory="2048m" haltonfailure="false">
            <formatter type="xml"/>
            <batchtest todir="${logs.results}">
                <fileset dir="${testssrc}">
                    <include name="**/Test*.java"/>
                    <include name="**/*Test.java"/>
                    <exclude name="org/supremica/testhelpers/**/*.java"/>
                    <exclude name="**/TestPackage*.java"/>
                    <exclude name="**/Abstract*.java"/>
                    <exclude name="**/Native*.java"/>
                    <exclude name="**/Large*.java"/>
                    <exclude name="net/sourceforge/waters/analysis/comp552/**/*.java"/>
                    <exclude name="net/sourceforge/waters/analysis/distributed/**/*.java"/>
                    <exclude name="net/sourceforge/waters/analysis/modular/**/*.java"/>
                </fileset>
            </batchtest>
            <classpath>
                <pathelement location="${dist}/Supremica.jar"/>
                <pathelement location="${dist}/SupremicaLib.jar"/>
                <pathelement location="${dist}/SupremicaTest.jar"/>
                <pathelement path="${java.class.path}"/>
            </classpath>
            <sysproperty key="supremica.test.inputdir" value="${basedir}/tests/testfiles"/>
            <sysproperty key="waters.test.inputdir" value="${examples}"/>
            <sysproperty key="waters.test.outputdir" value="${logs.results}"/>
            <sysproperty key="waters.test.ant" value="true"/>
            <sysproperty key="java.library.path" value="${dist}"/>
            <jvmarg value="-enableassertions"/>
        </junit>
    </target>
    
    <target name="-run_tests_short"
            depends="-jar_supremica,-jar_supremica_tests">
        <mkdir dir="${logs.results}"/>
        <junit printsummary="on" fork="true" maxmemory="2048m" haltonfailure="false">
            <formatter type="xml"/>
            <batchtest todir="${logs.results}">
                <fileset dir="${testssrc}">
                    <exclude name="**/*Test.java"/>
                    <exclude name="**/Test*.java"/>
                    <exclude name="org/supremica/testhelpers/**/*.java"/>
                    <exclude name="**/TestPackage*.java"/>
                    <exclude name="**/Abstract*.java"/>
                    <exclude name="**/Native*.java"/>
                    <exclude name="net/sourceforge/waters/**/*.java"/>
                </fileset>
            </batchtest>
            <classpath>
                <pathelement location="${dist}/Supremica.jar"/>
                <pathelement location="${dist}/SupremicaLib.jar"/>
                <pathelement location="${dist}/SupremicaTest.jar"/>
                <pathelement path="${java.class.path}"/>
            </classpath>
            <sysproperty key="waters.test.inputdir" value="${examples}"/>
            <sysproperty key="waters.test.outputdir" value="${logs.results}"/>
            <sysproperty key="waters.test.ant" value="true"/>
            <sysproperty key="java.library.path" value="${dist}"/>
            <jvmarg value="-enableassertions"/>
        </junit>
    </target>
    
    <target name="-run_test_minimization" depends="-jar_supremica,-jar_supremica_tests">
        <mkdir dir="${logs.results}/algorithms/minimization"/>
        <delete>
            <fileset dir="${logs.results}/algorithms/minimization" includes="**/log4j.log"/>
        </delete>
        <junit printsummary="on" fork="true" maxmemory="2048m">
            <formatter type="xml"/>
            <batchtest todir="${logs.results}">
                <fileset dir="${testssrc}">
                    <include name="org/supremica/automata/algorithms/minimization/*.java"/>
                    <include name="org/supremica/automata/algorithms/TestAutomataVerifier.java"/>
                </fileset>
            </batchtest>
            <classpath>
                <pathelement location="${dist}/Supremica.jar"/>
                <pathelement location="${dist}/SupremicaLib.jar"/>
                <pathelement location="${dist}/SupremicaTest.jar"/>
                <pathelement path="${java.class.path}"/>
            </classpath>
            <sysproperty key="supremica.test.inputdir" value="${basedir}/tests/testfiles"/>
            <sysproperty key="waters.test.inputdir" value="${basedir}/${examples}"/>
            <sysproperty key="waters.test.outputdir" value="${logs.results}"/>
            <sysproperty key="waters.test.ant" value="true"/>
            <sysproperty key="java.library.path" value="${dist}"/>
            <jvmarg value="-enableassertions"/>
        </junit>
    </target>
    
    <target name="run_test6" depends="build">
        <java classname="net.sourceforge.waters.analysis.modular.SpeedComparison" fork="true" maxmemory="512m">
            <classpath>
                <pathelement location="${dist}/Supremica.jar"/>
                <pathelement location="${dist}/SupremicaLib.jar"/>
                <pathelement location="${dist}/SupremicaTest.jar"/>
                <pathelement path="${java.class.path}"/>
            </classpath>
            <sysproperty key="waters.test.inputdir" value="${examples}"/>
            <sysproperty key="waters.test.outputdir" value="${logs.results}"/>
            <sysproperty key="waters.test.ant" value="true"/>
            <sysproperty key="java.library.path" value="${dist}"/>
        </java>
    </target>
    
    <target name="run_test8" depends="build">
        <java classname="net.sourceforge.waters.analysis.modular.SpeedComparison2" fork="true" maxmemory="512m">
            <classpath>
                <pathelement location="${dist}/Supremica.jar"/>
                <pathelement location="${dist}/SupremicaLib.jar"/>
                <pathelement location="${dist}/SupremicaTest.jar"/>
                <pathelement path="${java.class.path}"/>
            </classpath>
            <sysproperty key="waters.test.inputdir" value="${examples}"/>
            <sysproperty key="waters.test.outputdir" value="${logs.results}"/>
            <sysproperty key="waters.test.ant" value="true"/>
            <sysproperty key="java.library.path" value="${dist}"/>
        </java>
    </target>
    
    <target name="run_test9" depends="build">
        <java classname="net.sourceforge.waters.analysis.modular.SpeedComparison3" fork="true" maxmemory="512m">
            <classpath>
                <pathelement location="${dist}/Supremica.jar"/>
                <pathelement location="${dist}/SupremicaLib.jar"/>
                <pathelement location="${dist}/SupremicaTest.jar"/>
                <pathelement path="${java.class.path}"/>
            </classpath>
            <sysproperty key="waters.test.inputdir" value="${examples}"/>
            <sysproperty key="waters.test.outputdir" value="${logs.results}"/>
            <sysproperty key="waters.test.ant" value="true"/>
            <sysproperty key="java.library.path" value="${dist}"/>
        </java>
    </target>
    
    <target name="run_test7" depends="build">
        <mkdir dir="${logs.results}"/>
        <delete>
            <fileset dir="${logs.results}" includes="**/log4j.log"/>
        </delete>
        <junit printsummary="on" fork="true" maxmemory="2048m" haltonfailure="false">
            <formatter type="xml"/>
            <batchtest todir="${logs.results}">
                <fileset dir="${testssrc}">
                    <include name="**/NewConflictCheckerTest.java"/>
                    <exclude name="**/Test*.java"/>
                    <exclude name="org/supremica/testhelpers/**/*.java"/>
                    <exclude name="**/TestPackage*.java"/>
                    <exclude name="**/Abstract*.java"/>
                    <exclude name="**/Native*.java"/>
                    <exclude name="net/sourceforge/waters/analysis/modular/**/*.java"/>
                </fileset>
            </batchtest>
            <classpath>
                <pathelement location="${dist}/Supremica.jar"/>
                <pathelement location="${dist}/SupremicaLib.jar"/>
                <pathelement location="${dist}/SupremicaTest.jar"/>
                <pathelement path="${java.class.path}"/>
            </classpath>
            <sysproperty key="waters.test.inputdir" value="${examples}"/>
            <sysproperty key="waters.test.outputdir" value="${logs.results}"/>
            <sysproperty key="waters.test.ant" value="true"/>
            <sysproperty key="java.library.path" value="${dist}"/>
        </junit>
    </target>
    
    <target name="run_test10" depends="build">
        <mkdir dir="${logs.results}"/>
        <delete>
            <fileset dir="${logs.results}" includes="**/log4j.log"/>
        </delete>
        <junit printsummary="on" fork="true" maxmemory="2048m" haltonfailure="false">
            <formatter type="xml"/>
            <batchtest todir="${logs.results}">
                <fileset dir="${testssrc}">
                    <include name="**/AlphaConflictCheckerTest.java"/>
                    <exclude name="**/Test*.java"/>
                    <exclude name="org/supremica/testhelpers/**/*.java"/>
                    <exclude name="**/TestPackage*.java"/>
                    <exclude name="**/Abstract*.java"/>
                    <exclude name="**/Native*.java"/>
                    <exclude name="net/sourceforge/waters/analysis/modular/**/*.java"/>
                </fileset>
            </batchtest>
            <classpath>
                <pathelement location="${dist}/Supremica.jar"/>
                <pathelement location="${dist}/SupremicaLib.jar"/>
                <pathelement location="${dist}/SupremicaTest.jar"/>
                <pathelement path="${java.class.path}"/>
            </classpath>
            <sysproperty key="waters.test.inputdir" value="${examples}"/>
            <sysproperty key="waters.test.outputdir" value="${logs.results}"/>
            <sysproperty key="waters.test.ant" value="true"/>
            <sysproperty key="java.library.path" value="${dist}"/>
        </junit>
    </target>
    
    <target name="test_report">
        <mkdir dir="${logs.reports}"/>
        <junitreport todir="${logs.reports}">
            <fileset dir="${logs.results}">
                <include name="TEST-*.xml"/>
            </fileset>
            <report format="frames" todir="${logs.reports}"/>
        </junitreport>
        <echo>Test report can be found in ${logs.reports}.</echo>
    </target>
    
    <target name="test" depends="-run_tests,test_report"
     description="Runs unit tests and produces a test report. This is a comprehensive test that takes several minutes."/>

    <target name="test_min" depends="-run_test_minimization,test_report"/>
    
    <target name="test_short" depends="-run_tests_short,test_report"
     description="Runs unit tests and produces a test report. This is a shorter test that should take less than a minute."/>
     
    <target name="test_bdd" depends="compile_supremica,-startfiles_supremica" 
            description="Run BDD specific tests, requires the BDD library for your architecture to be accessible">
        <java dir="${dist}" fork="yes" classname="org.supremica.util.BDD.test.TestAlgo" taskname="bdd_tests" failonerror="true">                
            <!-- ok, this is funny. if fork is "yes", we do start in ${dist}, otherwise in the Supremica-root -->
            <classpath> 
                <pathelement location="${build}" />
                <pathelement location="${testsbuild}" />
                <pathelement path="${lib}/${unjared}" />
                <pathelement path="${java.class.path}" />
            </classpath>        
        </java>
    </target>
    <!--
                packagenames="${supremica_basepackage}.automata.*,${supremica_basepackage}.gui.*,${supremica_basepackage}.util.*,${supremica_basepackage}.apps.*"
-->
    
    <target name="doc" depends="doc_supremica" description="Generate Javadoc documentation."/>
    
    <target name="doc_supremica">
        <javadoc
            sourcepath="${src}"
            destdir="${doc}/api"
            classpath="${lib}/${unjared}"
            encoding="ISO-8859-1"
            author="true"
            version="true"
            use="true"
            private="true"
            source="1.7"
            maxmemory="512m"
            windowtitle="Supremica API"
            bottom="Copyright &#169; 2001 - 2011 Supremica and Knut Åkesson, Martin Fabian, Hugo Flordal, Robi Malik, Arash Vahidi. All Rights Reserved.">
            <doctitle><![CDATA[<h1>Supremica and Waters API Documentation</h1>]]></doctitle>
            <packageset dir="${src}">
                <include name="org/supremica/**/*"/>
                <include name="net/sourceforge/waters/**/*"/>
                <exclude name="org/supremica/functionblocks/xsd/*/impl/**"/>
                <exclude name="net/sourceforge/waters/xsd/*/impl/**"/>
                <exclude name="org/supremica/softplc/**"/>
            </packageset>       
            <link href="${java17.api.url}"
                  offline="true" packagelistLoc="${docsrc}/offline/j2sdk"/>
            <link href="${jaxme.api.url}"
                  offline="true" packagelistLoc="${docsrc}/offline/jaxme"/>
            <link href="${junit.api.url}"
                  offline="true" packagelistLoc="${docsrc}/offline/junit"/>
        </javadoc>
    </target>
    <!--        THIS ONE WAS PREVIOUSLY INCLUDED ABOVE...  -->
    <!--        overview="${templates}/Overview.html"      -->
    
    <target name="doc_waters">
        <mkdir dir="${javadoc}"/>
        <javadoc destdir="${javadoc}">
            <packageset dir="${src}">
                <include name="net/sourceforge/waters/xsd/**/*"/>
                <exclude name="net/sourceforge/waters/xsd/*/impl/**"/>
            </packageset>
            <packageset dir="${supremica.src}">
                <include name="net/sourceforge/waters/**/*"/>
                <exclude name="net/sourceforge/waters/gui/**"/>
            </packageset>
            <doctitle><![CDATA[<h1>Waters API Documentation</h1>]]></doctitle>
            <link href="${java17.api.url}"
                  offline="true" packagelistLoc="${docsrc}/offline/j2sdk"/>
            <link href="${jaxme.api.url}"
                  offline="true" packagelistLoc="${docsrc}/offline/jaxme"/>
            <link href="${junit.api.url}"
                  offline="true" packagelistLoc="${docsrc}/offline/junit"/>
            <classpath>
                <path refid="external-classpath"/>
                <pathelement location="${junit.jar}"/>
            </classpath>
        </javadoc>
    </target>
        
    <target name="run">
        <java classname="${supremica_basepackage}.gui.ide.IDE" fork="yes">
            <arg value="-p"/>
            <arg value="dist/SupremicaProperties.cfg"/>
            <classpath>
                <pathelement location="${dist}/Supremica.jar" />
                <pathelement location="${dist}/SupremicaLib.jar" />
                <pathelement path="${java.class.path}" />
            </classpath>
            <jvmarg value="-Xms128M"/>
            <jvmarg value="-Xmx2048M" />  
        </java>                
    </target>
    
    <target name="runLocal">
        <java classname="${supremica_basepackage}.gui.ide.IDE" fork="yes">
            <arg value="-p"/>
            <arg value="dist/SupremicaProperties.cfg"/>
            <classpath>
                <pathelement location="build" />
                <pathelement location="lib/unjared" />
                <pathelement location="images" />
                <pathelement location="examples" />
                <pathelement path="${java.class.path}" />
            </classpath>            
            <jvmarg value="-Xms128M"/>
            <jvmarg value="-Xmx1024M" />
            <jvmarg value="-Djava.library.path=${dist}"/>
        </java>
    </target>
    
    <target name="runSupremica">
        <java classname="${supremica_basepackage}.apps.Supremica" fork="yes">
            <arg value="-p"/>
            <arg value="dist/SupremicaProperties.cfg"/>
            <classpath>
                <pathelement location="${dist}/Supremica.jar" />
                <pathelement location="${dist}/SupremicaLib.jar" />
                <pathelement path="${java.class.path}" />
            </classpath>
            <jvmarg value="-Xms128M"/>
            <jvmarg value="-Xmx2048M" />  
        </java>                
    </target>
    
    <target name="runSupremicaLocal">
        <java classname="${supremica_basepackage}.apps.Supremica" fork="yes">
            <arg value="-p"/>
            <arg value="dist/SupremicaProperties.cfg"/>
            <classpath>
                <pathelement location="build" />
                <pathelement location="lib/unjared" />
                <pathelement location="images" />
                <pathelement location="examples" />
                <pathelement path="${java.class.path}" />
            </classpath>            
            <jvmarg value="-Xms128M"/>
            <jvmarg value="-Xmx2048M" />       
        </java>
    </target>
    
    <target name="run_fbruntime">
        <java classname="${supremica_basepackage}.apps.FBRuntime" fork="yes">
            <classpath>
                <pathelement location="${build}" />
                <pathelement location="${dist}/Supremica.jar" />
                <pathelement location="${dist}/SupremicaLib.jar" />
                <pathelement path="${java.class.path}" />
            </classpath>
            <arg value="Kulbana_composit.sys"/>
            <arg value="${examples}/functionblocks/FBRuntime"/>
        </java>
    </target>
        
    <target name="deploy" depends="deployWeb">
    </target>
    
    <target name="deployLocal">
        <copy file="${dist}/Supremica.jar" todir="C:\Supremica Installer\Input\Runtime\NoArch"/>        
        <copy file="${dist}/SupremicaLib.jar" todir="C:\Supremica Installer\Input\Runtime\NoArch"/>     
        <copy file="${platform}/win.x86/lib/buddy.dll" todir="${installer.dir}\Input"/> 
        <chmod file="${installer.dir}\Input\buddy.dll" perm="644"/>
        <copy file="${platform}/win.x86/lib/BisimulationEquivalence.dll" todir="${installer.dir}\Input"/>       
        <chmod file="${installer.dir}\Input\BisimulationEquivalence.dll" perm="644"/>
        <copy file="${platform}/win.x86/lib/21100280.LIC" todir="${installer.dir}\Input"/>      
        <chmod file="${installer.dir}\Input\21100280.LIC" perm="644"/>
        <copy file="${platform}/linux.x86/lib/libbuddy.so" todir="${installer.dir}\Input"/>     
        <chmod file="${installer.dir}\Input\libbuddy.so" perm="644"/>
        <copy file="${platform}/linux.x86/lib/libBisimulationEquivalence.so" todir="${installer.dir}\Input"/>   
        <chmod file="${installer.dir}\Input\libBisimulationEquivalence.so" perm="644"/>
        <exec executable="C:\Progra~1\INNOSE~1\iscc.exe">
            <arg value="C:\Supremica Installer\SupremicaDist.iss"/>
        </exec>
    </target>
    
    <target name="deployWeb">
        <copy file="${dist}/Supremica.jar" todir="W:\public_html\Supremica\updates\noarch"/>    
        <copy file="${dist}/SupremicaLib.jar" todir="W:\public_html\Supremica\updates\noarch"/> 
        <copy file="${dist}/Supremica.jar" todir="C:\Supremica Installer\Input\Runtime\NoArch"/>        
        <copy file="${dist}/SupremicaLib.jar" todir="C:\Supremica Installer\Input\Runtime\NoArch"/>     
        <copy file="${platform}/win.x86/lib/buddy.dll" todir="${installer.dir}\Input"/> 
        <chmod file="${installer.dir}\Input\buddy.dll" perm="644"/>
        <copy file="${platform}/win.x86/lib/BisimulationEquivalence.dll" todir="${installer.dir}\Input"/>       
        <chmod file="${installer.dir}\Input\BisimulationEquivalence.dll" perm="644"/>
        <copy file="${platform}/win.x86/lib/21100280.LIC" todir="${installer.dir}\Input"/>      
        <chmod file="${installer.dir}\Input\21100280.LIC" perm="644"/>
        <copy file="${platform}/linux.x86/lib/libbuddy.so" todir="${installer.dir}\Input"/>     
        <chmod file="${installer.dir}\Input\libbuddy.so" perm="644"/>
        <copy file="${platform}/linux.x86/lib/libBisimulationEquivalence.so" todir="${installer.dir}\Input"/>   
        <chmod file="${installer.dir}\Input\libBisimulationEquivalence.so" perm="644"/>
        <exec executable="C:\Progra~1\INNOSE~1\iscc.exe">
            <arg value="C:\Supremica Installer\SupremicaDist.iss"/>
        </exec>
        <copy file="C:\Supremica Installer\Output\setup.exe" todir="W:\public_html\Supremica\distributions\windows"/>   
    </target>
    
    <!-- Don't use this. This is used by the automated builder at supremica.s2.chalmers.se to
    send dialy build results. This target will only work for the automated build script --> 
    <target name="mail_buildlog">
        <mail mailhost="mail.medic.chalmers.se" mailport="25" subject="Supremica Build" encoding="plain" files="/tmp/supremica_buildlog_tail,/tmp/supremica_buildlog">
            <from address="ka@s2.chalmers.se"/>
            <to address="ka@s2.chalmers.se"/>
            <message>The daily build has completed</message>
        </mail>
    </target>
    
    <!-- Run the different BDD algorithms for cpmputing RAS unsafe states-->
    
    <target name="benchmark-ras-classic">
        <foreach param="ras-path" target="-execute-one-ras-classic">
            <path> 
                <fileset dir="${examples}/ras-examples" casesensitive="no"/>
            </path>
        </foreach>
    </target>
      
    <target name="-execute-one-ras-classic">
        <echo message="executing the classic algo on ${ras-path}"/>
        <java classname="${supremica_basepackage}.automata.BDD.EFA.RASAlgorithmsRunner" 
                      fork="yes" 
                      output="ras_classic_log.txt" append="true"> 
            <arg value="${ras-path}"/> 
            <arg value="MINIMALITY_C"/>
            <arg value="5000000"/>
            <arg value="500000"/>
            <arg value="10"/>
            <classpath>
                <pathelement location="build" />
                <pathelement location="lib/unjared" />
                <pathelement path="${java.class.path}" />
            </classpath>            
            <jvmarg value="-Xms128M"/>
            <jvmarg value="-Xmx4096M" />
            <jvmarg value="-Djava.library.path=${dist}"/>
        </java>
    </target>
    
    <target name="benchmark-ras-alternative">
        <foreach param="ras-path" target="-execute-one-ras-alternative">
            <path> 
                <fileset dir="${examples}/ras-examples" casesensitive="no"/>
            </path>
        </foreach>
    </target>
    
    <target name="-execute-one-ras-alternative">
        <echo message="executing the alternative algo on ${ras-path}"/>
        <java classname="${supremica_basepackage}.automata.BDD.EFA.RASAlgorithmsRunner" 
                      fork="yes" 
                      output="ras_alternative_log.txt" append="true"> 
            <arg value="${ras-path}"/> 
            <arg value="MINIMALITY_M"/>
            <arg value="5000000"/>
            <arg value="500000"/>
            <arg value="10"/>
            <classpath>
                <pathelement location="build" />
                <pathelement location="lib/unjared" />
                <pathelement path="${java.class.path}" />
            </classpath>            
            <jvmarg value="-Xms128M"/>
            <jvmarg value="-Xmx4096M" />
            <jvmarg value="-Djava.library.path=${dist}"/>
        </java>
    </target>
	
	<target name="benchmark-ras-partition">
		<foreach param="ras-path" target="-execute-one-ras-partition">
            <path> 
                <fileset dir="${examples}/ras-examples" casesensitive="no"/>
            </path>
		</foreach>
	</target>
	
    <target name="-execute-one-ras-partition">
        <echo message="executing the partitioned algo on ${ras-path}"/>
        <java classname="${supremica_basepackage}.automata.BDD.EFA.RASAlgorithmsRunner" 
                      fork="yes" 
  					  output="ras_partition_log.txt" append="true"> 
            <arg value="${ras-path}"/> 
            <arg value="MINIMALITY_P"/>
            <arg value="5000000"/>
            <arg value="500000"/>
            <arg value="10"/>
            <classpath>
                <pathelement location="build" />
                <pathelement location="lib/unjared" />
                <pathelement path="${java.class.path}" />
            </classpath>            
            <jvmarg value="-Xms128M"/>
            <jvmarg value="-Xmx4096M" />
            <jvmarg value="-Djava.library.path=${dist}"/>
        </java>
    </target>
    
	<!-- Package Supremica on Mac-->
	<property environment="env" />
	
    <taskdef name="bundleapp"
             classname="com.oracle.appbundler.AppBundlerTask"   
             classpath="lib/appbundler-1.0.jar" />

    <target name="bundle-Supremica">
        <bundleapp outputdirectory="${dist}"
            name="Supremica"
            displayname="Supremica"
        	icon="${images}/icons/Supremica.icns"
        	shortversion="0.1"	
            identifier="${supremica_basepackage}.gui.ide.IDE"
            mainclassname="${supremica_basepackage}.gui.ide.IDE">
        	<runtime dir="${env.JAVA_HOME}" />
            <classpath file="${dist}/Supremica.jar"/>
        	<classpath file="${dist}/SupremicaLib.jar"/>
            <option value="-Dapple.laf.useScreenMenuBar=true"/>
        </bundleapp>
    </target>
</project>

